<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>The Interactive Nostalgia</title>
  <link href="https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

  <style>
    /* === ğŸ©¸ ê¸°ë³¸ ì„¤ì • === */
    body { background-color: #f4f1eb; color: #333; font-family: 'Galmuri9', sans-serif; margin: 0; padding: 0; overflow: hidden; user-select: none; display: flex; }

    /* === ğŸ¥‘ ì¢Œì¸¡ ë©”ë‰´ë°” (ë ˆí¼ëŸ°ìŠ¤ & ì•„ë³´ì¹´ë„ ê°ì„±) === */
    #sidebar { 
        width: 120px; height: 100vh; background: #fff; border-right: 2px dashed #d1c8b8; 
        display: flex; flex-direction: column; align-items: center; padding-top: 50px; box-shadow: 2px 0 15px rgba(0,0,0,0.03); z-index: 100;
    }
    .menu-btn { 
        width: 80px; margin-bottom: 25px; padding: 15px 0; text-align: center; cursor: pointer; 
        font-size: 13px; font-weight: bold; color: #888; background: #faf9f5; border: 1px solid #eae5d9; border-radius: 12px;
        transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.02);
    }
    .menu-btn div { font-size: 24px; margin-bottom: 8px; transition: 0.2s; }
    .menu-btn:hover { background: #fff0f5; color: #d81b60; border-color: #f8bbd0; transform: translateY(-3px); box-shadow: 0 6px 12px rgba(216,27,96,0.1); }
    .menu-btn:hover div { transform: scale(1.1); }

    /* === ğŸ–¼ï¸ ìš°ì¸¡ ë©”ì¸ ê³µê°„ === */
    #main-stage {
        flex-grow: 1; height: 100vh; display: flex; justify-content: center; align-items: center; background: #fdfdfc; position: relative;
    }

    /* =========================================
       [ì°¨ì› 1] ğŸ©¸ ì§„ì§œ HTML ìš”ì†Œë¡œ ì¡°ë¦½ëœ 'ê³ ì • ë¹„ìœ¨' ê¸°ë¯¹ ë£¸
       (íˆ¬ëª… ë¸”ë¡ ê¼¼ìˆ˜ ì œê±°. ì ˆëŒ€ ì•ˆ ê¹¨ì§)
       ========================================= */
    #room-frame {
        width: 100%; max-width: 900px; aspect-ratio: 16 / 10; /* ê³ ì • ë¹„ìœ¨ í”„ë ˆì„ */
        background: #000; position: relative; overflow: hidden; border: 8px solid #fff; 
        border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.08); transition: filter 0.3s ease;
    }

    /* ë²½ì§€ (ë…¸ì„ + ê½ƒë¬´ëŠ¬) */
    .room-wall {
        position: absolute; top: 0; left: 0; width: 100%; height: 60%;
        background: linear-gradient(to bottom, rgba(139, 0, 0, 0.9), rgba(210, 105, 30, 0.8)), url('https://www.transparenttextures.com/patterns/floral-pattern.png');
    }
    /* ë…¸ë€ ì¥íŒ (ë°”ë‹¥) */
    .room-floor {
        position: absolute; bottom: 0; left: 0; width: 100%; height: 40%;
        background: linear-gradient(to bottom, #cda043, #9e7a2f); border-top: 2px solid #8b5a2b;
    }

    /* ì „ë“± (ê¸°ë¯¹) */
    .gimmick-light {
        position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 15%; height: 12%; 
        background: rgba(255,255,255,0.9); border-radius: 50%; border: 3px solid #555;
        box-shadow: 0 0 50px #fff, 0 0 20px #ffeb3b; cursor: pointer; display: flex; justify-content: center; align-items: flex-end; 
        padding-bottom: 5px; font-size: 11px; font-weight: bold; color: #333; z-index: 50;
    }
    .gimmick-light:active { transform: translateX(-50%) scale(0.95); }

    /* ì–´ë‘  íš¨ê³¼ */
    #room-darkness { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); pointer-events: none; opacity: 0; transition: 0.3s; z-index: 40; }
    #room-frame.is-dark #room-darkness { opacity: 1; }

    /* ì‚¬ì„  ë¹› íš¨ê³¼ */
    .light-beam {
        position: absolute; top: 15%; right: 10%; width: 50%; height: 85%;
        background: linear-gradient(120deg, rgba(255,200,150,0.3) 0%, rgba(255,100,50,0.1) 40%, transparent 70%);
        clip-path: polygon(100% 0, 100% 40%, 0 100%, 0 60%); pointer-events: none; mix-blend-mode: screen; z-index: 5;
    }

    /* ì „ë´‡ëŒ€ì™€ ê¹Œë§ˆê·€ (ì¢Œì¸¡ ë°°ì¹˜) */
    .gimmick-pole { position: absolute; top: 10%; left: 15%; width: 3%; height: 60%; background: #222; z-index: 10; border-radius: 5px; }
    .gimmick-wire { position: absolute; top: 25%; left: 0; width: 50%; height: 2px; background: #111; z-index: 9; transform: rotate(3deg); }
    .gimmick-crow { position: absolute; font-size: 1.5rem; cursor: pointer; transition: 1s cubic-bezier(0.25, 1, 0.5, 1); z-index: 15; filter: drop-shadow(2px 2px 0 #000); }
    .gimmick-crow.fly { transform: translate(300px, -300px) scale(2); opacity: 0; pointer-events: none; }

    /* ì°½ë¬¸ (ìš°ì¸¡ ë°°ì¹˜) - ì§„ì§œ div ë°•ìŠ¤ */
    .gimmick-window {
        position: absolute; top: 15%; right: 10%; width: 25%; height: 45%; 
        border: 12px solid #5d4037; background: rgba(255, 200, 200, 0.6); cursor: pointer; z-index: 20; 
        box-shadow: inset 0 0 20px rgba(0,0,0,0.5), 10px 10px 0px rgba(0,0,0,0.3); display: flex; flex-direction: column; justify-content: center; align-items: center; 
        color: #fff; text-shadow: 1px 1px #000; font-size: 14px; font-weight: bold; border-radius: 5px;
    }
    .gimmick-window:hover { filter: brightness(1.2); }
    .window-pot { width: 50px; height: 40px; background: #3e2723; border-radius: 5px; border: 2px solid #000; margin-bottom: 10px; font-size: 20px; display:flex; justify-content:center; align-items:center; }
    
    /* ìŸì•„ì§€ëŠ” ë¬¼ì¤„ê¸° */
    .waterfall { position: absolute; top: 100%; right: 10%; width: 80%; height: 60vh; background: linear-gradient(to bottom, rgba(100, 150, 255, 0.4), rgba(100, 150, 255, 0.8)); animation: flow 1s infinite linear; pointer-events: none; }
    @keyframes flow { 0% { background-position: 0 0; } 100% { background-position: 0 100px; } }

    /* ìºë¦­í„° ê·¸ë¦¼ì */
    .gimmick-character {
        position: absolute; bottom: 35%; left: 45%; width: 12%; height: 40%; 
        background: #111; border-radius: 50px 50px 10px 10px; cursor: pointer; z-index: 25; 
        box-shadow: 10px 10px 0 rgba(0,0,0,0.5); transition: 0.2s; display: flex; justify-content: center; align-items: center; color: #fff; font-size: 12px;
        background-size: contain; background-repeat: no-repeat; background-position: center;
    }
    .gimmick-character:hover { transform: scale(1.05) translateY(-5px); }

    /* ê¹¨ì§€ëŠ” í™”ë¶„ */
    .gimmick-pot { position: absolute; cursor: pointer; z-index: 30; transition: 0.2s; display: flex; flex-direction: column; align-items: center; filter: drop-shadow(5px 5px 0px rgba(0,0,0,0.3));}
    .gimmick-pot .plant { font-size: 3rem; margin-bottom: -15px; z-index: 31; transition: 0.3s; }
    .gimmick-pot .base { width: 60px; height: 60px; background: #e0e0e0; border-radius: 10px 10px 30px 30px; border: 3px solid #888; z-index: 32; }
    .gimmick-pot.broken .plant { opacity: 0; transform: translateY(30px) rotate(45deg); pointer-events: none; }
    .gimmick-pot.broken .base { background: transparent; border: none; box-shadow: none; font-size: 40px; line-height: 60px; }

    /* ê±°ëŒ€ ì´ë¶ˆ (ê²Œì‹œíŒ ë²„íŠ¼) - ì¢Œì¸¡ í•˜ë‹¨ */
    .gimmick-bed {
        position: absolute; bottom: 5%; left: 5%; width: 35%; height: 35%; 
        background: #f48fb1; border-radius: 20px 20px 0 0; border: 5px solid #d81b60; z-index: 35; 
        box-shadow: 15px 15px 0px rgba(0,0,0,0.3); cursor: pointer; display: flex; justify-content: center; align-items: center; 
        font-size: 1.5rem; color: #fff; font-weight: bold; text-shadow: 2px 2px 0px #000; transition: 0.3s;
        background-size: cover; background-position: center;
    }
    .gimmick-bed:hover { transform: translateY(-10px); filter: brightness(1.1); }
    .bed-pillow { position: absolute; top: 10%; left: 10%; width: 40%; height: 25%; background: #fff; border-radius: 20px; border: 3px solid #ccc; transform: rotate(5deg); }


    /* =========================================
       ğŸ€ ì•„ë³´ì¹´ë„ ê°ì„± UI (íŒì—…ì°½ ë° ë©”ë‰´)
       ========================================= */
    .cute-popup { position: absolute; display: none; background: #fff; border: 1px solid #eee; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); overflow: hidden; width: 550px; color: #444; z-index: 2000; }
    .cute-titlebar { background: #fff; color: #888; padding: 15px 20px; font-size: 13px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: grab; border-bottom: 1px solid #f0f0f0; letter-spacing: 1px;}
    .cute-body { padding: 25px; max-height: 65vh; overflow-y: auto; background: #faf9f7;}
    
    .cute-body::-webkit-scrollbar { width: 8px; }
    .cute-body::-webkit-scrollbar-thumb { background: #e0e0e0; border-radius: 10px; }
    
    .close-x { cursor: pointer; color: #bbb; font-size: 16px; transition: 0.2s; }
    .close-x:hover { color: #d81b60; }
    
    .btn-action { background: #fff; color: #666; border: 1px solid #ddd; border-radius: 20px; padding: 8px 18px; font-family: 'Galmuri9'; font-size: 12px; cursor: pointer; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.02);}
    .btn-action:hover { background: #fff0f5; color: #d81b60; border-color: #f8bbd0; transform: translateY(-1px);}
    .btn-action:active { transform: translateY(1px); box-shadow: none;}
    
    .cute-input { width: 100%; padding: 12px; margin-bottom: 15px; background: #fff; border: 1px solid #e5e5e5; border-radius: 10px; color: #555; font-family: 'Galmuri9'; box-sizing: border-box; outline: none; transition: 0.2s;}
    .cute-input:focus { border-color: #f8bbd0; box-shadow: 0 0 0 3px rgba(248, 187, 208, 0.2); }

    .post-item { margin-bottom: 15px; background: #fff; border-radius: 12px; border: 1px solid #eee; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.02);}
    .post-header { padding: 15px 20px; font-weight: normal; color: #555; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s;}
    .post-header:hover { background: #fafafa; color: #d81b60; }
    .post-content-area { padding: 20px; display: none; background: #fff; font-size: 13px; line-height: 1.8; color: #666; border-top: 1px dashed #eee;}
    
    .upload-box { background: #fff; padding: 15px; border: 1px dashed #ccc; border-radius: 12px; margin-bottom: 15px; text-align: center; }

  </style>
</head>
<body>

  <div id="sidebar">
      <div class="menu-btn" onclick="location.reload()"><div>ğŸ </div>Room</div>
      <div class="menu-btn" onclick="openBoard('diary')"><div>ğŸ“–</div>Diary</div>
      <div class="menu-btn" onclick="openPopup('config-window')"><div>âš™ï¸</div>Setup</div>
  </div>

  <div id="main-stage">
      
      <div id="room-frame">
          <div class="room-wall"></div>
          <div class="room-floor"></div>
          <div class="light-beam"></div>
          <div id="room-darkness"></div>

          <div class="gimmick-light" onclick="toggleLight()">ë”¸ê¹!</div>

          <div class="gimmick-pole"></div>
          <div class="gimmick-wire"></div>
          <div class="gimmick-crow" style="top: 20%; left: 20%;" onclick="flyCrow(this)">ğŸ¦â€â¬›</div>
          <div class="gimmick-crow" style="top: 21%; left: 35%;" onclick="flyCrow(this)">ğŸ¦â€â¬›</div>

          <div class="gimmick-window" onclick="alert('ë‹¤ë¥¸ ì°½ìœ¼ë¡œ ì´ë™... ì¤€ë¹„ ì¤‘...')">
              <div class="window-pot">â™¨ï¸</div>
              <span>ì°½ë¬¸ ë°–<br>ì•Œ ìˆ˜ ì—†ìŒ</span>
              <div class="waterfall"></div>
          </div>

          <div class="gimmick-pot" style="bottom: 25%; left: 35%;" onclick="breakPot(this)">
              <div class="plant">ğŸŒ¿</div><div class="base"></div>
          </div>
          <div class="gimmick-pot" style="bottom: 45%; left: 20%;" onclick="breakPot(this)">
              <div class="plant">ğŸŒµ</div><div class="base"></div>
          </div>

          <div id="char-element" class="gimmick-character" onclick="alert('ìºë¦­í„° ëŒ€ì‚¬...')">ë§ê±¸ê¸°</div>

          <div id="bed-element" class="gimmick-bed" onclick="openBoard('diary')">
              <div class="bed-pillow"></div>
              <span>ë¹„ë°€ ì¼ê¸°ì¥</span>
          </div>
      </div>

  </div>

  <div id="board-window" class="cute-popup" style="top: 10%; left: 20%;">
      <div class="cute-titlebar">
          <span id="board-title">DIARY & BOARD</span>
          <div style="display:flex; align-items:center; gap:15px;">
              <button class="btn-action" onclick="openWrite()">ê¸€ì“°ê¸°</button>
              <span class="close-x" onclick="closePopup('board-window')">âœ–</span>
          </div>
      </div>
      <div class="cute-body" id="page-content">
          <div style="text-align:center; padding: 40px; color:#bbb;">ìˆ˜íŒŒë² ì´ìŠ¤ ì—°ê²° ëŒ€ê¸°ì¤‘...</div>
      </div>
  </div>

  <div id="write-window" class="cute-popup" style="top: 15%; left: 25%;">
      <div class="cute-titlebar"><span>ìƒˆ ê¸€ ì‘ì„±</span><span class="close-x" onclick="closePopup('write-window')">âœ–</span></div>
      <div class="cute-body">
          <select id="post-category" class="cute-input" style="width: 150px;">
              <option value="diary">ë¹„ë°€ ì¼ê¸°</option>
              <option value="guestbook">ë°©ëª…ë¡</option>
          </select>
          <input type="text" id="post-title" class="cute-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”...">
          
          <div class="upload-box">
              <span style="color:#888; font-size:12px;">ğŸ¥ ì˜ìƒ ê°„í¸ ì²¨ë¶€ (Supabase Storage)</span><br>
              <div style="display:flex; gap:10px; justify-content:center; margin-top:10px; align-items:center;">
                  <input type="file" id="video-file" accept="video/*" style="font-size:11px; color:#666;">
                  <button class="btn-action" id="btn-vid-upload" onclick="uploadVideoToSupabase()">ë³¸ë¬¸ì— ì‚½ì…</button>
              </div>
          </div>

          <textarea id="post-content"></textarea>
          <div style="text-align:right; margin-top:20px;"><button class="btn-action" style="background:#fff0f5; color:#d81b60; border-color:#f8bbd0;" onclick="savePost()">ê¸°ë¡í•˜ê¸°</button></div>
      </div>
  </div>

  <div id="config-window" class="cute-popup" style="width: 400px; top: 20%; right: 10%;">
      <div class="cute-titlebar"><span>SETTING</span><span class="close-x" onclick="closePopup('config-window')">âœ–</span></div>
      <div class="cute-body">
          <p style="font-size:12px; color:#888; text-align:center; margin-bottom:20px;">ê° íŒŒíŠ¸ì˜ ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ê°ˆì•„ ë¼ìš°ì‹­ì‹œì˜¤.</p>
          <div style="margin-bottom:15px; font-size:12px; color:#555;">ğŸ–¼ï¸ ì „ì²´ ë£¸ ë°°ê²½ <input type="file" accept="image/*" class="cute-input" style="margin-top:5px; padding:8px;" onchange="handleImageUpload(event, 'bg')"></div>
          <div style="margin-bottom:15px; font-size:12px; color:#555;">ğŸ‘¤ ìºë¦­í„° <input type="file" accept="image/*" class="cute-input" style="margin-top:5px; padding:8px;" onchange="handleImageUpload(event, 'char')"></div>
          <div style="margin-bottom:15px; font-size:12px; color:#555;">ğŸ›ï¸ ì¹¨ëŒ€ <input type="file" accept="image/*" class="cute-input" style="margin-top:5px; padding:8px;" onchange="handleImageUpload(event, 'bed')"></div>
          <div style="text-align:center; margin-top:20px; border-top:1px dashed #eee; padding-top:20px;"><button class="btn-action" onclick="resetImages()">ì´ˆê¸°í™”</button></div>
      </div>
  </div>

  <script>
    let highestZ = 3000;
    
    // ìˆ˜íŒŒë² ì´ìŠ¤ DB 
    const SB_URL = "https://kzgbqpodvpuoqovfsyrm.supabase.co";
    const SB_KEY = "sb_publishable_pdqE1Sc-4PSv3LQM9IsBcA_xJWeZwW-";
    let sbClient = window.supabase ? window.supabase.createClient(SB_URL, SB_KEY) : null;
    
    CKEDITOR.replace('post-content', { height: 200, language: 'ko', removeButtons: 'About', versionCheck: false, toolbarCanCollapse: true });

    // ğŸªŸ ê¸°ë¯¹ ìŠ¤í¬ë¦½íŠ¸
    function openPopup(id) { const el = document.getElementById(id); el.style.display = 'block'; el.style.zIndex = ++highestZ; }
    function closePopup(id) { document.getElementById(id).style.display = 'none'; }
    function toggleLight() { document.getElementById('room-frame').classList.toggle('is-dark'); }
    function flyCrow(el) { el.classList.add('fly'); setTimeout(() => el.classList.remove('fly'), 5000); }
    function breakPot(el) { 
        if(!el.classList.contains('broken')) {
            el.classList.add('broken'); el.querySelector('.base').innerText = 'ğŸ’¥';
            setTimeout(() => { el.classList.remove('broken'); el.querySelector('.base').innerText = '';}, 4000);
        }
    }

    // ë“œë˜ê·¸ ë§ˆìˆ 
    function makeDraggable(winId) { 
        const win = document.getElementById(winId); const dragArea = win.querySelector('.cute-titlebar'); if(!dragArea) return;
        let p1=0, p2=0, p3=0, p4=0; win.onmousedown = () => win.style.zIndex = ++highestZ; 
        dragArea.onmousedown = (e) => { e.preventDefault(); p3=e.clientX; p4=e.clientY; document.onmouseup = () => { document.onmouseup=null; document.onmousemove=null; }; document.onmousemove = (e) => { e.preventDefault(); p1=p3-e.clientX; p2=p4-e.clientY; p3=e.clientX; p4=e.clientY; win.style.top=(win.offsetTop-p2)+"px"; win.style.left=(win.offsetLeft-p1)+"px"; }; }; 
    }
    ['config-window', 'board-window', 'write-window'].forEach(makeDraggable);

    // ğŸ–¼ï¸ ì´ë¯¸ì§€ ì»¤ìŠ¤í…€ ë¡œì§
    function handleImageUpload(event, targetElement) {
        const file = event.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const dataUrl = e.target.result;
            let saved = JSON.parse(localStorage.getItem('myRoomFinalImgs')) || {};
            if(targetElement === 'bg') { document.getElementById('room-frame').style.backgroundImage = `url(${dataUrl})`; document.getElementById('room-frame').style.backgroundSize = 'cover'; saved.bg = dataUrl; } 
            else if(targetElement === 'char') { const charEl = document.getElementById('char-element'); charEl.style.backgroundImage = `url(${dataUrl})`; charEl.innerHTML = ''; charEl.style.backgroundColor = 'transparent'; charEl.style.boxShadow = 'none'; saved.char = dataUrl; } 
            else if(targetElement === 'bed') { const bedEl = document.getElementById('bed-element'); bedEl.style.backgroundImage = `url(${dataUrl})`; bedEl.style.backgroundColor = 'transparent'; bedEl.innerHTML = ''; bedEl.style.border = 'none'; bedEl.style.boxShadow = 'none'; saved.bed = dataUrl; }
            localStorage.setItem('myRoomFinalImgs', JSON.stringify(saved));
        };
        reader.readAsDataURL(file);
    }
    function loadSavedImages() {
        const saved = JSON.parse(localStorage.getItem('myRoomFinalImgs')) || {};
        if(saved.bg) { document.getElementById('room-frame').style.backgroundImage = `url(${saved.bg})`; document.getElementById('room-frame').style.backgroundSize = 'cover'; }
        if(saved.char) { const charEl = document.getElementById('char-element'); charEl.style.backgroundImage = `url(${saved.char})`; charEl.innerHTML = ''; charEl.style.backgroundColor = 'transparent'; charEl.style.boxShadow = 'none'; }
        if(saved.bed) { const bedEl = document.getElementById('bed-element'); bedEl.style.backgroundImage = `url(${saved.bed})`; bedEl.style.backgroundColor = 'transparent'; bedEl.innerHTML = ''; bedEl.style.border = 'none'; bedEl.style.boxShadow = 'none'; }
    }
    function resetImages() { localStorage.removeItem('myRoomFinalImgs'); location.reload(); }

    // ğŸ“ ìˆ˜íŒŒë² ì´ìŠ¤ ê²Œì‹œíŒ
    async function openBoard(type) { 
        document.getElementById('board-title').innerText = type==='diary' ? 'SECRET DIARY' : 'GUEST BOOK'; 
        document.getElementById('post-category').value = type; 
        const list = document.getElementById('page-content');
        list.innerHTML = '<div style="text-align:center; padding: 40px; color:#bbb;">ê¸°ì–µì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>'; 
        openPopup('board-window'); 
        
        if (!sbClient) return list.innerHTML = '<div style="text-align:center; padding: 40px; color:#bbb;">DB ì—ëŸ¬...</div>';
        const {data, error} = await sbClient.from('posts').select('*').eq('category', type).order('created_at',{ascending:false});
        if(error || !data || data.length === 0) return list.innerHTML = '<div style="text-align:center; padding: 40px; color:#bbb;">ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        
        list.innerHTML = data.map(p => `
            <div class="post-item">
                <div class="post-header" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='block'?'none':'block'">
                    <span>ğŸ“ ${p.title}</span> <span style="font-size:11px; color:#aaa;">${new Date(p.created_at).toLocaleDateString()}</span>
                </div>
                <div class="post-content-area">${p.content}</div>
            </div>
        `).join('');
    }
    
    function openWrite() { document.getElementById('post-title').value = ''; CKEDITOR.instances['post-content'].setData(''); openPopup('write-window'); }
    
    async function savePost() { 
        if(!sbClient) return;
        const category = document.getElementById('post-category').value; const title = document.getElementById('post-title').value; const content = CKEDITOR.instances['post-content'].getData();
        if(!title.trim()) return alert("ì œëª©ì„ ~ ì ì–´ë¼...");
        await sbClient.from('posts').insert([{title, content, category}]); 
        closePopup('write-window'); openBoard(category); 
    }

    // ğŸ¥ ìˆ˜íŒŒë² ì´ìŠ¤ ì˜ìƒ ì—…ë¡œë“œ
    async function uploadVideoToSupabase() {
        const file = document.getElementById('video-file').files[0];
        if(!file || !sbClient) return alert("ì˜ìƒì„ ~ ê³¨ë¼ë¼...!");
        const btn = document.getElementById('btn-vid-upload');
        btn.innerText = "ì—…ë¡œë“œ ì¤‘..."; btn.disabled = true;

        const fileName = Date.now() + '_' + file.name;
        const { error } = await sbClient.storage.from('videos').upload(fileName, file);
        if(error) { alert("ì—…ë¡œë“œ ì‹¤íŒ¨..."); btn.innerText = "ë³¸ë¬¸ì— ì‚½ì…"; btn.disabled = false; return; }

        const { data } = sbClient.storage.from('videos').getPublicUrl(fileName);
        CKEDITOR.instances['post-content'].insertHtml(`<p style="text-align:center;"><video src="${data.publicUrl}" controls style="max-width:100%; border-radius:8px;"></video></p><p><br></p>`);
        
        btn.innerText = "ì‚½ì… ì™„ë£Œ!";
        setTimeout(() => { btn.innerText = "ë³¸ë¬¸ì— ì‚½ì…"; btn.disabled = false; document.getElementById('video-file').value = ''; }, 2000);
    }

    window.onload = loadSavedImages;
  </script>
</body>
</html>
