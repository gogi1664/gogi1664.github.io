<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë‚˜ì˜ ë ˆíŠ¸ë¡œ ë°ìŠ¤í¬íƒ‘</title>
  <link href="https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

  <style>
    /* === ğŸªŸ ë ˆíŠ¸ë¡œ OS ê¸°ë³¸ ì„¤ì • === */
    body { margin: 0; padding: 0; overflow: hidden; font-family: 'Galmuri9', monospace; background-color: #008080; /* ê³ ì „ì ì¸ ì²­ë¡ìƒ‰ ë°°ê²½ */ user-select: none; cursor: default; }
    
    /* ë°”íƒ•í™”ë©´ ë°°ê²½ íŒ¨í„´ (íƒ€ì¼) */
    #desktop-background {
        position: absolute; top: 0; left: 0; width: 100%; height: calc(100vh - 30px);
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAIklEQVQYV2NkYGD4D8SMQIwXgLCIAGwAkwOyAmwAKCgAABQYBAJoU6ACAAAAAElFTkSuQmCC'); /* ê°„ë‹¨í•œ ë„íŠ¸ íŒ¨í„´ */
        background-repeat: repeat;
        z-index: 0;
    }

    /* === ğŸ–¥ï¸ ë°”íƒ•í™”ë©´ ì•„ì´ì½˜ === */
    .desktop-icon {
        position: absolute; width: 64px; text-align: center; color: #fff; font-size: 11px; cursor: pointer;
        text-shadow: 1px 1px 0 #000; display: flex; flex-direction: column; align-items: center;
    }
    .desktop-icon img { width: 32px; height: 32px; margin-bottom: 5px; image-rendering: pixelated; }
    .desktop-icon:hover { background-color: rgba(0, 0, 128, 0.3); border: 1px dotted #fff; }

    /* === ğŸ“¼ í•˜ë‹¨ ì‘ì—…í‘œì‹œì¤„ === */
    #taskbar {
        position: absolute; bottom: 0; left: 0; width: 100%; height: 28px;
        background: #c0c0c0; border-top: 2px solid #fff; display: flex; align-items: center; padding: 0 2px; box-sizing: border-box; z-index: 9999;
    }
    #start-button {
        display: flex; align-items: center; height: 22px; padding: 0 5px; margin-right: 5px;
        background: #c0c0c0; border-top: 2px solid #fff; border-left: 2px solid #fff; border-right: 2px solid #000; border-bottom: 2px solid #000;
        font-weight: bold; cursor: pointer; box-shadow: inset 1px 1px #dfdfdf;
    }
    #start-button img { width: 16px; height: 16px; margin-right: 3px; }
    #start-button:active { border-top: 2px solid #000; border-left: 2px solid #000; border-right: 2px solid #fff; border-bottom: 2px solid #fff; box-shadow: none; padding-top: 2px; padding-left: 7px; }
    
    .taskbar-divider { width: 2px; height: 20px; background: #808080; border-right: 1px solid #fff; margin: 0 5px; }
    
    #clock { margin-left: auto; padding: 0 10px; background: #c0c0c0; border: 2px inset; height: 20px; display: flex; align-items: center; font-size: 11px; }

    /* === ğŸ”² ë ˆíŠ¸ë¡œ ì°½ë¬¸ (ìœˆë„ìš°) ìŠ¤íƒ€ì¼ === */
    .retro-window {
        position: absolute; background: #c0c0c0; border-top: 2px solid #fff; border-left: 2px solid #fff; border-right: 2px solid #000; border-bottom: 2px solid #000;
        box-shadow: 1px 1px 0 #000; display: none; flex-direction: column; overflow: hidden;
    }
    .window-titlebar {
        background: navy; color: #fff; padding: 2px 5px; font-weight: bold; font-size: 12px;
        display: flex; justify-content: space-between; align-items: center; cursor: grab;
    }
    .window-titlebar.active { background: navy; }
    .window-titlebar.inactive { background: #808080; color: #c0c0c0; }
    
    .window-controls { display: flex; gap: 2px; }
    .win-btn {
        width: 16px; height: 14px; background: #c0c0c0; border-top: 1px solid #fff; border-left: 1px solid #fff; border-right: 1px solid #000; border-bottom: 1px solid #000;
        font-size: 9px; display: flex; justify-content: center; align-items: center; cursor: pointer; color: #000;
    }
    .win-btn:active { border-top: 1px solid #000; border-left: 1px solid #000; border-right: 1px solid #fff; border-bottom: 1px solid #fff; padding-top: 1px; padding-left: 1px; }
    .win-btn.close-btn { font-weight: bold; }

    .window-content {
        flex-grow: 1; position: relative; overflow: auto;
        background: #fff; border: 2px inset #c0c0c0; margin: 2px;
    }

    /* === ğŸ  [í•µì‹¬] ì°½ë¬¸ ì•ˆì˜ ì¸í„°ë™í‹°ë¸Œ ë£¸ === */
    #room-window-content {
        /* ì´ê³³ì´ ë°©ì˜ ì»¨í…Œì´ë„ˆê°€ ë©ë‹ˆë‹¤. ì ˆëŒ€ ì¢Œí‘œì˜ ê¸°ì¤€ì  */
        position: relative; width: 100%; height: 100%; overflow: hidden;
        /* ì´ˆê¸° ë°°ê²½ (ìŠ¤ì¼€ì¹˜ ì—…ë¡œë“œ ì „) */
        background: linear-gradient(to bottom, #8b0000, #d2691e);
        background-size: cover; background-position: center;
    }

    /* --- ë°© ì•ˆì˜ ê¸°ë¯¹ë“¤ (ìœ„ì¹˜ì™€ ìŠ¤íƒ€ì¼ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë˜, ë¶€ëª¨ê°€ ë°”ë€œ) --- */
    /* ì–´ë‘  ì˜¤ë²„ë ˆì´ */
    #room-darkness { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); pointer-events: none; z-index: 90; transition: 0.3s; opacity: 0; }
    .is-dark #room-darkness { opacity: 1; }
    /* ì „ë“± ìŠ¤ìœ„ì¹˜ (íˆ¬ëª… ì˜ì—­) */
    #scene-light-switch { position: absolute; top: 0; left: 40%; width: 20%; height: 15%; cursor: pointer; z-index: 100; }
    
    /* ê¹Œë§ˆê·€ì™€ ì „ê¹ƒì¤„ */
    #scene-wire { position: absolute; top: 20%; left: -5%; width: 60%; height: 2px; background: #000; z-index: 10; transform: rotate(5deg); }
    .crow { position: absolute; top: -20px; font-size: 24px; cursor: pointer; z-index: 11; transition: 1s; }
    .crow.fly { transform: translate(500px, -500px) scale(2); opacity: 0; }

    /* ì°½ë¬¸ (íˆ¬ëª… í´ë¦­ ì˜ì—­) */
    #scene-window-click { position: absolute; top: 15%; right: 10%; width: 25%; height: 40%; cursor: pointer; z-index: 20; }
    /* ì°½ë¬¸ì—ì„œ ìŸì•„ì§€ëŠ” ë¬¼ (ì¥ì‹) */
    #waterfall-deco { position: absolute; bottom: -20%; right: 12%; width: 20%; height: 60%; background: linear-gradient(to bottom, rgba(100,150,255,0.5), rgba(100,150,255,0.8)); animation: flow 1s infinite linear; pointer-events: none; z-index: 15; }
    @keyframes flow { 0% { background-position: 0 0; } 100% { background-position: 0 100px; } }

    /* ìºë¦­í„° (íˆ¬ëª… í´ë¦­ ì˜ì—­) */
    #scene-character-click { position: absolute; bottom: 30%; left: 40%; width: 15%; height: 35%; cursor: pointer; z-index: 50; }

    /* í™”ë¶„ë“¤ */
    .scene-pot { position: absolute; cursor: pointer; z-index: 30; font-size: 50px; transition: 0.2s; }
    .scene-pot.broken { transform: translateY(30px) rotate(45deg) scale(0.8); opacity: 0.7; }

    /* ì¹¨ëŒ€ (íˆ¬ëª… í´ë¦­ ì˜ì—­) */
    #scene-bed-click { position: absolute; bottom: 0; left: 5%; width: 40%; height: 30%; cursor: pointer; z-index: 40; transform: perspective(500px) rotateX(20deg); }

    /* === ğŸ“ ê²Œì‹œíŒ ë° ê¸°íƒ€ ì°½ ìŠ¤íƒ€ì¼ === */
    .post-item { border: 2px inset #c0c0c0; background: #fff; margin-bottom: 5px; padding: 5px; font-size: 12px; }
    .post-header { font-weight: bold; cursor: pointer; display: flex; justify-content: space-between; }
    .post-header:hover { background: #000080; color: #fff; }
    .post-content-area { display: none; padding-top: 5px; border-top: 1px dotted #000; }
    
    .retro-input, .retro-select, .retro-textarea {
        width: 100%; box-sizing: border-box; border: 2px inset #c0c0c0; background: #fff; font-family: 'Galmuri9'; padding: 3px; margin-bottom: 5px; font-size: 12px;
    }
    .retro-textarea { height: 200px; resize: none; }
    
    .retro-button {
        background: #c0c0c0; border-top: 2px solid #fff; border-left: 2px solid #fff; border-right: 2px solid #000; border-bottom: 2px solid #000;
        padding: 2px 10px; font-family: 'Galmuri9'; font-size: 12px; cursor: pointer;
    }
    .retro-button:active { border-top: 2px solid #000; border-left: 2px solid #000; border-right: 2px solid #fff; border-bottom: 2px solid #fff; padding: 3px 9px 1px 11px; }

    /* ì—…ë¡œë“œ ë°•ìŠ¤ */
    .upload-group { border: 2px groove #c0c0c0; padding: 5px; margin-bottom: 5px; background: #dfdfdf; }
    .upload-label { font-size: 11px; margin-bottom: 3px; display: block; }

  </style>
</head>
<body>

  <div id="desktop-background"></div>

  <div class="desktop-icon" style="top: 20px; left: 20px;" onclick="openWindow('room-window')">
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAKlBMVEUAAAD///8zMzNEREQAAACZmZkzMzOZZmZmZmZERAARERERERGIiIgRERH1c2WJAAAADXRSTlMABgcICQ4PEBITFBcZ8YOwAAAAgklEQVQoz2NgwA0YQhgwmLyBCEYwExkYmEwZGBg5jICInI2BgYk1BKoAJs4QxGACF2eIZDABKTAyBDGIALmMDJEMIQwOYAWCDCEMoQwhDGEgYogC6jIEM4QwaICljIEKjKACJlABJmMDM0OQEYgBFZgYjIwgE5jAjElA2QkMAAAq+R116c1nLAAAAABJRU5ErkJggg==">
      ë‚´ ë°©ìœ¼ë¡œ ê°€ê¸°
  </div>
  <div class="desktop-icon" style="top: 100px; left: 20px;" onclick="alert('ë¹„ì›Œë„ ë¹„ì›Œë„... ê°€ë“ ì°¨ ìˆë‹¤...')">
      <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAIVBMVEUAAAD///8RERERERGIiIgAAACZmZkzMzMzMzNERERERAAdXU0DAAAACnRSTlMABgcICQ4PEBMX6t74kQAAAGdJREFUKM9jYCAdsMYwYDATGhiYjBkYGLkZGIgYWBkYmFhBIs7cQALODJAIJ7g4I5gA1WUIYTAyBDOEMEQAhYwMQQwwC6QYQhiCGUIYjEEixlABCyMjaICZMYgB1WAEMaACZgYGAGV5IXkS56W0AAAAAElFTkSuQmCC">
      íœ´ì§€í†µ
  </div>

  <div id="room-window" class="retro-window" style="width: 800px; height: 600px; top: 50px; left: 100px;">
      <div class="window-titlebar">
          <span id="room-window-title">ğŸ  ë‚˜ì˜ ì‘ì€ ë°© - Internet Explorer?</span>
          <div class="window-controls">
              <div class="win-btn">_</div>
              <div class="win-btn">â–¡</div>
              <div class="win-btn close-btn" onclick="closeWindow('room-window')">X</div>
          </div>
      </div>
      <div class="window-content" style="background: #000; overflow: hidden;">
          
          <div id="room-window-content">
              <div id="room-darkness"></div>
              
              <div id="scene-light-switch" onclick="toggleLight()" title="ì „ë“± ìŠ¤ìœ„ì¹˜"></div>
              
              <div id="scene-wire">
                  <div class="crow" style="left: 30%;" onclick="flyCrow(this)">ğŸ¦â€â¬›</div>
                  <div class="crow" style="left: 50%;" onclick="flyCrow(this)">ğŸ¦â€â¬›</div>
              </div>
              
              <div id="scene-window-click" onclick="alert('ì°½ë¬¸ ë°–ì€... ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ë‹¤...')" title="ì°½ë¬¸"></div>
              <div id="waterfall-deco"></div>

              <div class="scene-pot" style="bottom: 25%; left: 30%;" onclick="breakPot(this)">ğŸŒ¿</div>
              <div class="scene-pot" style="bottom: 40%; left: 20%;" onclick="breakPot(this)">ğŸŒµ</div>

              <div id="scene-character-click" onclick="alert('... (ë§ì—†ì´ ë°”ë¼ë³¸ë‹¤)')" title="ìºë¦­í„°"></div>
              
              <div id="scene-bed-click" onclick="openWindow('board-window'); openBoard('diary');" title="ë¹„ë°€ ì¼ê¸°ì¥ (ì¹¨ëŒ€)"></div>

          </div>

      </div>
  </div>

  <div id="board-window" class="retro-window" style="width: 600px; height: 500px; top: 80px; left: 150px;">
      <div class="window-titlebar">
          <span id="board-title">ğŸ“– ë¹„ë°€ ì¼ê¸°ì¥</span>
          <div class="window-controls">
              <div class="win-btn close-btn" onclick="closeWindow('board-window')">X</div>
          </div>
      </div>
      <div class="window-content" style="display: flex; flex-direction: column;">
          <div style="padding: 5px; background: #c0c0c0; border-bottom: 2px groove #fff;">
              <button class="retro-button" onclick="openWindow('write-window')">âœï¸ ìƒˆ ê¸€ ì“°ê¸°</button>
              <select class="retro-select" style="width: auto; margin-left: 10px;" onchange="openBoard(this.value)">
                  <option value="diary">ë¹„ë°€ ì¼ê¸°</option>
                  <option value="guestbook">ë°©ëª…ë¡</option>
              </select>
          </div>
          <div id="board-list" style="flex-grow: 1; padding: 10px; overflow-y: auto; background: #fff;">
              ë¡œë”© ì¤‘...
          </div>
      </div>
  </div>

  <div id="write-window" class="retro-window" style="width: 500px; height: 550px; top: 100px; left: 200px;">
      <div class="window-titlebar">
          <span>ğŸ“ ê¸€ ì‘ì„±</span>
          <div class="window-controls">
              <div class="win-btn close-btn" onclick="closeWindow('write-window')">X</div>
          </div>
      </div>
      <div class="window-content" style="padding: 10px;">
          <select id="post-category" class="retro-select">
              <option value="diary">ë¹„ë°€ ì¼ê¸°</option>
              <option value="guestbook">ë°©ëª…ë¡</option>
          </select>
          <input type="text" id="post-title" class="retro-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤...">
          
          <div class="upload-group">
              <span class="upload-label">ğŸ“¼ ë¹„ë””ì˜¤ í…Œì´í”„ ì‚½ì… (Supabase Storage)</span>
              <div style="display: flex; gap: 5px;">
                  <input type="file" id="video-file" class="retro-input" accept="video/*" style="flex-grow: 1;">
                  <button class="retro-button" id="btn-vid-upload" onclick="uploadVideoToSupabase()">ì‚½ì…</button>
              </div>
          </div>

          <textarea id="post-content" class="retro-textarea"></textarea>
          <div style="text-align: right; margin-top: 10px;">
              <button class="retro-button" onclick="savePost()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
          </div>
      </div>
  </div>

  <div id="config-window" class="retro-window" style="width: 400px; height: 450px; top: 60px; left: 60px;">
      <div class="window-titlebar">
          <span>ğŸ’» ë‚´ ì»´í“¨í„° (ì„¤ì •)</span>
          <div class="window-controls">
              <div class="win-btn close-btn" onclick="closeWindow('config-window')">X</div>
          </div>
      </div>
      <div class="window-content" style="padding: 15px;">
          <p style="text-align: center; margin-top: 0;">ë°©ì˜ ëª¨ìŠµì„ ë³€ê²½í•©ë‹ˆë‹¤.</p>
          
          <div class="upload-group">
              <span class="upload-label">ğŸ–¼ï¸ ë²½ì§€ êµì²´ (ì „ì²´ ë°°ê²½)</span>
              <input type="file" class="retro-input" accept="image/*" onchange="handleImageUpload(event, 'bg')">
          </div>
          <div class="upload-group">
              <span class="upload-label">ğŸ‘¤ ì£¼ì¸ êµì²´ (ìºë¦­í„°)</span>
              <input type="file" class="retro-input" accept="image/*" onchange="handleImageUpload(event, 'char')">
          </div>
          <div class="upload-group">
              <span class="upload-label">ğŸ›ï¸ ì´ë¶ˆ êµì²´ (ì¹¨ëŒ€)</span>
              <input type="file" class="retro-input" accept="image/*" onchange="handleImageUpload(event, 'bed')">
          </div>

          <div style="text-align: center; margin-top: 20px;">
              <button class="retro-button" onclick="resetImages()">âš ï¸ ì´ˆê¸°í™” (ë³µêµ¬)</button>
          </div>
      </div>
  </div>

  <div id="taskbar">
      <div id="start-button" onclick="openWindow('config-window')">
          <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAFklEQVQYV2NkYGD4z4AHsGCRMJIQAABm4gIEd8651AAAAABJRU5ErkJggg==">
          ì‹œì‘
      </div>
      <div class="taskbar-divider"></div>
      <div id="clock">ì˜¤ì „ 12:00</div>
  </div>

  <script>
    // === ğŸªŸ ìœˆë„ìš° OS ì‹œìŠ¤í…œ ===
    let highestZ = 100;
    let activeWindow = null;

    function openWindow(id) {
        const win = document.getElementById(id);
        win.style.display = 'flex';
        win.style.zIndex = ++highestZ;
        setActiveWindow(win);
        if(id === 'write-window' && !CKEDITOR.instances['post-content']) {
             CKEDITOR.replace('post-content', { height: 300, language: 'ko', toolbarCanCollapse: true, resize_enabled: false });
        }
    }

    function closeWindow(id) {
        document.getElementById(id).style.display = 'none';
    }

    function setActiveWindow(win) {
        if (activeWindow) {
            activeWindow.querySelector('.window-titlebar').classList.remove('active');
            activeWindow.querySelector('.window-titlebar').classList.add('inactive');
        }
        win.querySelector('.window-titlebar').classList.remove('inactive');
        win.querySelector('.window-titlebar').classList.add('active');
        activeWindow = win;
    }

    // ì°½ ë“œë˜ê·¸ ê¸°ëŠ¥ (ë ˆíŠ¸ë¡œ ìŠ¤íƒ€ì¼)
    function makeDraggable(winId) {
        const win = document.getElementById(winId);
        const titleBar = win.querySelector('.window-titlebar');
        let isDragging = false;
        let offsetX, offsetY;

        win.onmousedown = () => {
            win.style.zIndex = ++highestZ;
            setActiveWindow(win);
        };

        titleBar.onmousedown = (e) => {
            if (e.target.classList.contains('win-btn')) return; // ë²„íŠ¼ í´ë¦­ ì‹œ ë“œë˜ê·¸ ë°©ì§€
            isDragging = true;
            offsetX = e.clientX - win.offsetLeft;
            offsetY = e.clientY - win.offsetTop;
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        };

        function onMouseMove(e) {
            if (!isDragging) return;
            win.style.left = (e.clientX - offsetX) + 'px';
            win.style.top = (e.clientY - offsetY) + 'px';
        }

        function onMouseUp() {
            isDragging = false;
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
        }
    }
    ['room-window', 'board-window', 'write-window', 'config-window'].forEach(makeDraggable);

    // ì‹œê³„ ì‘ë™
    setInterval(() => {
        const now = new Date();
        let hours = now.getHours();
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const ampm = hours >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „';
        hours = hours % 12; hours = hours ? hours : 12;
        document.getElementById('clock').innerText = `${ampm} ${hours}:${minutes}`;
    }, 1000);


    // === ğŸ  ë°© ì•ˆì˜ ìƒí˜¸ì‘ìš© (ê¸°ì¡´ ì½”ë“œ ìœ ì§€) ===
    function toggleLight() { document.getElementById('room-window-content').classList.toggle('is-dark'); }
    function flyCrow(el) { el.classList.add('fly'); setTimeout(() => el.classList.remove('fly'), 5000); }
    function breakPot(el) { 
        if(!el.classList.contains('broken')) {
            el.classList.add('broken'); setTimeout(() => el.classList.remove('broken'), 4000);
        }
    }

    // === ğŸ–¼ï¸ ì´ë¯¸ì§€ ì»¤ìŠ¤í…€ (ì„¤ì • ì°½) ===
    function handleImageUpload(event, target) {
        const file = event.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const dataUrl = e.target.result;
            let saved = JSON.parse(localStorage.getItem('retroRoomImgs')) || {};
            saved[target] = dataUrl;
            localStorage.setItem('retroRoomImgs', JSON.stringify(saved));
            applyImages();
        };
        reader.readAsDataURL(file);
    }
    function applyImages() {
        const saved = JSON.parse(localStorage.getItem('retroRoomImgs')) || {};
        if(saved.bg) document.getElementById('room-window-content').style.backgroundImage = `url(${saved.bg})`;
        if(saved.char) document.getElementById('scene-character-click').style.backgroundImage = `url(${saved.char})`;
        if(saved.bed) document.getElementById('scene-bed-click').style.backgroundImage = `url(${saved.bed})`;
    }
    function resetImages() { localStorage.removeItem('retroRoomImgs'); location.reload(); }

    // === ğŸ“¡ ìˆ˜íŒŒë² ì´ìŠ¤ ì—°ë™ (ê²Œì‹œíŒ & ì˜ìƒ) ===
    const SB_URL = "https://kzgbqpodvpuoqovfsyrm.supabase.co";
    const SB_KEY = "sb_publishable_pdqE1Sc-4PSv3LQM9IsBcA_xJWeZwW-";
    let sb = window.supabase ? window.supabase.createClient(SB_URL, SB_KEY) : null;

    async function openBoard(type) {
        document.getElementById('board-title').innerText = type === 'diary' ? 'ğŸ“– ë¹„ë°€ ì¼ê¸°ì¥' : 'ëª…ë¡';
        const list = document.getElementById('board-list');
        list.innerHTML = 'ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ì¤‘...';
        if(!sb) return list.innerHTML = 'DB ì—°ê²° ì‹¤íŒ¨.';
        
        const { data, error } = await sb.from('posts').select('*').eq('category', type).order('created_at', {ascending:false});
        if(error || !data || data.length === 0) return list.innerHTML = 'ì•„ì§ ì•„ë¬´ê²ƒë„ ì—†ë‹¤...';

        list.innerHTML = data.map(p => `
            <div class="post-item">
                <div class="post-header" onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'block' ? 'none' : 'block'">
                    <span>ğŸ“„ ${p.title}</span>
                    <small>${new Date(p.created_at).toLocaleDateString()}</small>
                </div>
                <div class="post-content-area">${p.content}</div>
            </div>
        `).join('');
    }

    async function savePost() {
        if(!sb) return alert('DB ì—°ê²° ëŠê¹€.');
        const title = document.getElementById('post-title').value;
        const content = CKEDITOR.instances['post-content'].getData();
        const category = document.getElementById('post-category').value;
        if(!title.trim()) return alert('ì œëª©ì´ ë¹„ì—ˆë‹¤.');
        
        await sb.from('posts').insert([{ title, content, category }]);
        closeWindow('write-window');
        openBoard(category);
        document.getElementById('post-title').value = '';
        CKEDITOR.instances['post-content'].setData('');
    }

    async function uploadVideoToSupabase() {
        const file = document.getElementById('video-file').files[0];
        if(!file || !sb) return alert('íŒŒì¼ì´ ì—†ê±°ë‚˜ DB ì—°ê²° ì‹¤íŒ¨.');
        const btn = document.getElementById('btn-vid-upload');
        btn.innerText = 'ì‚½ì… ì¤‘...'; btn.disabled = true;

        const fileName = Date.now() + '_' + file.name;
        const { error } = await sb.storage.from('videos').upload(fileName, file);
        if(error) { alert('ì—…ë¡œë“œ ì‹¤íŒ¨ (videos ë²„í‚· í™•ì¸ í•„ìš”)'); btn.innerText='ì‚½ì…'; btn.disabled=false; return; }
        
        const { data } = sb.storage.from('videos').getPublicUrl(fileName);
        const html = `<p style="text-align:center; border: 2px inset #c0c0c0; padding: 5px; background: #000;"><video src="${data.publicUrl}" controls style="max-width:100%;"></video></p><p><br></p>`;
        CKEDITOR.instances['post-content'].insertHtml(html);
        btn.innerText = 'ì™„ë£Œ';
        setTimeout(()=>{ btn.innerText='ì‚½ì…'; btn.disabled=false; document.getElementById('video-file').value=''; }, 2000);
    }

    // ì´ˆê¸°í™”
    window.onload = () => {
        applyImages();
        // ì²˜ìŒì— ë°© ì°½ë¬¸ì„ ì—´ì–´ë‘ 
        openWindow('room-window');
    };
  </script>
</body>
</html>
