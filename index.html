<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>기괴한 캡챠와 이상한 나라</title>
<link href="https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css" rel="stylesheet">
<script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

<style>
    /* === 무대 기본 설정 === */
    body { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Galmuri9', sans-serif; user-select: none; }
    #stage { position: relative; width: 100vw; height: 100vh; overflow: hidden; }

    /* === 인트로 (파스텔 캡챠) === */
    #scene-intro { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #e8d0d8; display: flex; justify-content: center; align-items: center; z-index: 100; transition: opacity 1s; }
    
    .captcha-box { background: #dcb3c4; padding: 20px; border-radius: 10px; border: 4px solid #c895a9; box-shadow: 10px 10px 0 rgba(0,0,0,0.1); text-align: center; position: relative; }
    .captcha-grid { display: grid; grid-template-columns: repeat(3, 80px); gap: 15px; margin: 20px 0; justify-content: center; }
    
    /* 도형 버튼들 */
    .shape-btn { width: 80px; height: 80px; background: #f4e1e8; border: 2px solid #b77b90; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: 0.2s; }
    .shape-btn:hover { background: #fff; transform: scale(1.05); }
    
    .blob1 { width: 50px; height: 50px; background: #d8b4e2; border-radius: 40% 60% 70% 30% / 40% 50% 60% 50%; }
    .blob2 { width: 50px; height: 50px; background: #a8d8ea; border-radius: 60% 40% 30% 70% / 60% 30% 70% 40%; }
    .blob3 { width: 50px; height: 50px; background: #f3dfa2; border-radius: 50% 50% 20% 80% / 25% 80% 20% 75%; }
    .triangle-true { width: 0; height: 0; border-left: 25px solid transparent; border-right: 25px solid transparent; border-bottom: 45px solid #82b5a5; }

    .captcha-text { color: #6b4c5a; font-size: 18px; font-weight: bold; margin-top: 15px; letter-spacing: -1px; }

    /* 가짜 비디오 플레이어 인터페이스 (세모 외 클릭 시 등장) */
    #fake-player { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 200; flex-direction: column; justify-content: space-between; padding: 20px; box-sizing: border-box; }
    .player-top { display: flex; justify-content: flex-end; color: #fff; font-size: 24px; }
    .player-center { display: flex; justify-content: center; align-items: center; gap: 40px; color: rgba(255,255,255,0.8); }
    .player-icon { cursor: pointer; font-size: 30px; font-weight: bold; letter-spacing: -2px; }
    .player-icon.play { font-size: 50px; }
    .player-bottom { display: flex; align-items: center; gap: 10px; }
    .progress-bar { flex-grow: 1; height: 5px; background: rgba(255,255,255,0.3); position: relative; }
    .progress-fill { width: 30%; height: 100%; background: #82b5a5; position: absolute; top: 0; left: 0; }
    .progress-handle { width: 15px; height: 15px; background: #fff; border-radius: 50%; position: absolute; top: -5px; left: 30%; }

    /* === 붉은 벨벳 커튼 === */
    .curtain { position: absolute; top: 0; width: 50%; height: 100%; background: linear-gradient(to right, #4a0000, #800000, #4a0000); z-index: 90; transition: transform 2s cubic-bezier(0.65, 0, 0.35, 1); box-shadow: inset 0 0 50px rgba(0,0,0,0.8); }
    #curtain-left { left: 0; transform-origin: left; border-right: 5px solid #ffcc00; }
    #curtain-right { right: 0; transform-origin: right; border-left: 5px solid #ffcc00; }
    .open-left { transform: scaleX(0); }
    .open-right { transform: scaleX(0); }

    /* === 로비 (이상한 나라) === */
    #scene-lobby { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at center, #2c3e50, #000); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; transition: 1s; opacity: 1; }
    .lobby-title { color: #fff; font-size: 30px; text-shadow: 2px 2px 10px #000; margin-bottom: 50px; letter-spacing: 5px; }

    /* 기묘한 버튼들 */
    .floating-items { display: flex; gap: 50px; align-items: flex-end; }
    .item-wrapper { display: flex; flex-direction: column; align-items: center; cursor: pointer; animation: float 3s ease-in-out infinite; }
    .item-wrapper:nth-child(2) { animation-delay: 0.5s; }
    .item-wrapper:nth-child(3) { animation-delay: 1s; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }

    /* CSS 회중시계 */
    .css-watch { width: 80px; height: 80px; border-radius: 50%; border: 8px solid #ffd700; background: #fff; position: relative; box-shadow: 0 10px 20px rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; }
    .watch-hand { width: 4px; height: 30px; background: #000; position: absolute; bottom: 50%; transform-origin: bottom; transform: rotate(45deg); border-radius: 2px; }
    
    /* CSS 체셔 미소 */
    .css-smile { width: 100px; height: 50px; border-bottom: 12px solid #a020f0; border-radius: 0 0 50px 50px; box-shadow: 0 10px 20px rgba(160,32,240,0.4); position: relative; }
    
    /* CSS 트럼프 카드 */
    .css-card { width: 60px; height: 90px; background: #fff; border-radius: 5px; border: 2px solid #000; position: relative; display: flex; justify-content: center; align-items: center; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
    .css-heart { width: 20px; height: 20px; background: #f00; transform: rotate(-45deg); position: relative; margin-top: 10px; }
    .css-heart::before, .css-heart::after { content: ''; width: 20px; height: 20px; background: #f00; border-radius: 50%; position: absolute; }
    .css-heart::before { top: -10px; left: 0; }
    .css-heart::after { top: 0; left: 10px; }

    .item-text { color: #fff; margin-top: 15px; font-size: 14px; text-shadow: 1px 1px 0 #000; font-weight: bold; }

    /* 토끼굴 (노란장판 입구) */
    .rabbit-hole { margin-top: 60px; width: 120px; height: 40px; border-radius: 50%; background: radial-gradient(ellipse at center, #000 0%, #111 50%, #333 100%); box-shadow: 0 0 30px #000; cursor: pointer; display: flex; justify-content: center; align-items: center; color: rgba(255,255,255,0.2); font-size: 10px; transition: 0.5s; }
    .rabbit-hole:hover { transform: scale(1.2) rotate(10deg); color: #fff; background: radial-gradient(ellipse at center, #000 0%, #4a0000 100%); }

    /* === 노란장판 룸 === */
    #scene-room { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to bottom, #4a2e2e 0%, #2e1d1d 50%, #cda043 50%, #9e7a2f 100%); z-index: 5; opacity: 0; transform: scale(1.5); transition: 1.5s ease-in-out; pointer-events: none; }
    .room-active { opacity: 1 !important; transform: scale(1) !important; pointer-events: auto !important; z-index: 20 !important; }
    
    .room-window { position: absolute; top: 15%; right: 15%; width: 200px; height: 250px; border: 15px solid #3d2314; background: #7a5c5c; box-shadow: inset 0 0 50px #000; color: #fff; display: flex; justify-content: center; align-items: center; }
    .room-bed { position: absolute; bottom: 5%; left: 10%; width: 300px; height: 150px; background: #b56c83; border: 5px solid #6b3e4e; border-radius: 20px; transform: perspective(500px) rotateX(20deg); color: #fff; display: flex; justify-content: center; align-items: center; }
    
    /* 로비로 돌아가는 비상구 */
    .btn-return { position: absolute; top: 20px; left: 20px; padding: 10px 20px; background: #111; color: #fff; border: 2px solid #555; cursor: pointer; border-radius: 5px; box-shadow: 3px 3px 0 #000; }
    .btn-return:hover { background: #333; }

    /* === 광기의 관객들 === */
    #audience { position: absolute; bottom: -100px; left: 0; width: 100%; height: 100px; z-index: 9999; display: flex; justify-content: space-around; align-items: flex-end; transition: transform 0.2s; pointer-events: none; }
    .audience-head { width: 40px; height: 60px; background: #111; border-radius: 50px 50px 0 0; position: relative; }
    .audience-hand { width: 15px; height: 15px; background: #333; border-radius: 50%; position: absolute; top: -10px; left: -10px; animation: clap 0.1s infinite alternate; }
    .audience-hand.right { left: auto; right: -10px; animation-delay: 0.05s; }
    @keyframes clap { 0% { transform: translateY(0) scale(1); } 100% { transform: translateY(-10px) scale(1.2); background: #555; } }
    .clapping-active { transform: translateY(-100px); }

    /* === 기묘한 팝업창 (로비용) === */
    .alice-popup { position: absolute; display: none; background: #fdf5e6; border: 8px solid #8b4513; border-radius: 5px; box-shadow: 0 20px 50px rgba(0,0,0,0.8); width: 600px; z-index: 2000; top: 10%; left: 50%; transform: translateX(-50%); outline: 2px solid #000; outline-offset: -10px; }
    .alice-header { background: #8b4513; color: #fdf5e6; padding: 10px; text-align: center; font-weight: bold; cursor: grab; letter-spacing: 2px; position: relative; }
    .alice-body { padding: 20px; max-height: 60vh; overflow-y: auto; color: #333; }
    .btn-close { position: absolute; top: 8px; right: 15px; color: #fdf5e6; cursor: pointer; font-size: 16px; font-weight: bold; }
    .btn-close:hover { color: #f00; }
    
    .alice-select { background: transparent; border: 1px solid #8b4513; font-family: 'Galmuri9'; padding: 5px; margin-bottom: 10px; width: 150px; outline: none; }

</style>
</head>
<body>

<div id="stage">

    <div id="audience"></div>

    <div id="scene-intro">
        <div id="fake-player">
            <div class="player-top">[ x ]</div>
            <div class="player-center">
                <div class="player-icon" onclick="resetIntro()">[ |◁ ]</div>
                <div class="player-icon play" onclick="resetIntro()">[ ▷ ]</div>
                <div class="player-icon" onclick="resetIntro()">[ ▷| ]</div>
            </div>
            <div class="player-bottom">
                <div class="progress-bar">
                    <div class="progress-fill"></div>
                    <div class="progress-handle"></div>
                </div>
                <div>[ 0:00 / 0:00 ]</div>
            </div>
        </div>

        <div class="captcha-box">
            <div style="font-size: 12px; color: #888; text-align: left;">보안 확인.</div>
            <div class="captcha-grid">
                <div class="shape-btn" onclick="wrongClick()"><div class="blob1"></div></div>
                <div class="shape-btn" onclick="wrongClick()"><div class="blob2"></div></div>
                <div class="shape-btn" onclick="wrongClick()"><div class="blob3"></div></div>
                <div class="shape-btn" onclick="wrongClick()"><div class="blob2" style="border-radius: 50%;"></div></div>
                <div class="shape-btn" onclick="openCurtain()"><div class="triangle-true"></div></div>
                <div class="shape-btn" onclick="wrongClick()"><div class="blob1" style="transform: rotate(45deg);"></div></div>
            </div>
            <div class="captcha-text">세모 모양을 선택하십시오.</div>
        </div>
    </div>

    <div id="curtain-left" class="curtain"></div>
    <div id="curtain-right" class="curtain"></div>

    <div id="scene-lobby">
        <div class="lobby-title">THE THEATER OF ABSURDITY</div>
        
        <div class="floating-items">
            <div class="item-wrapper" onclick="openPopup('write-window')">
                <div class="css-watch"><div class="watch-hand"></div></div>
                <div class="item-text">일기장 (Write)</div>
            </div>
            <div class="item-wrapper" onclick="alert('프로필 준비 중')">
                <div class="css-smile"></div>
                <div class="item-text">프로필 (Profile)</div>
            </div>
            <div class="item-wrapper" onclick="alert('공지사항 준비 중')">
                <div class="css-card"><div class="css-heart"></div></div>
                <div class="item-text">공지 (Notice)</div>
            </div>
        </div>

        <div class="rabbit-hole" onclick="fallToRoom()">Deep Hole...</div>
    </div>

    <div id="scene-room">
        <div class="btn-return" onclick="returnToLobby()">[ 로비로 돌아가기 ]</div>
        <div class="room-window">창문 밖</div>
        <div class="room-bed">비밀 일기장</div>
    </div>

</div>

<div id="write-window" class="alice-popup">
    <div class="alice-header">
        만년필과 양피지
        <div class="btn-close" onclick="closePopup('write-window')">X</div>
    </div>
    <div class="alice-body">
        <select class="alice-select">
            <option value="diary">비밀 일기</option>
            <option value="profile">캐릭터 프로필</option>
            <option value="notice">공지사항</option>
        </select>
        
        <input type="text" placeholder="제목을 적어라..." style="width: 100%; padding: 10px; margin-bottom: 10px; background: transparent; border: 1px solid #8b4513; font-family: 'Galmuri9'; outline: none; box-sizing: border-box;">
        
        <textarea id="post-content"></textarea>
        
        <div style="text-align:right; margin-top:20px;">
            <button style="background: #8b4513; color: #fff; border: none; padding: 10px 20px; font-family: 'Galmuri9'; cursor: pointer; box-shadow: 2px 2px 0 #000;">기록하기</button>
        </div>
    </div>
</div>

<script>
    // 현재 씬 상태 (intro, lobby, room)
    let currentScene = 'intro';

    // 딸깍 소리 생성기 (AudioContext)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playClickSound() {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'square';
        osc.frequency.setValueAtTime(600, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
        gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }

    // 관객 생성기
    const audienceDiv = document.getElementById('audience');
    for(let i=0; i<15; i++) {
        audienceDiv.innerHTML += `<div class="audience-head"><div class="audience-hand"></div><div class="audience-hand right"></div></div>`;
    }

    // 전역 클릭 이벤트 (소리 + 조건부 박수)
    document.addEventListener('click', () => {
        playClickSound();
        // 오직 로비 씬에서만 박수갈채 허용
        if(currentScene === 'lobby') {
            audienceDiv.classList.add('clapping-active');
            setTimeout(() => { audienceDiv.classList.remove('clapping-active'); }, 800);
        }
    });

    // 가짜 캡챠 (세모 외 클릭 시)
    function wrongClick() {
        document.getElementById('fake-player').style.display = 'flex';
    }

    // 플레이어 버튼 클릭 시 다시 캡챠로 복구
    function resetIntro() {
        document.getElementById('fake-player').style.display = 'none';
    }

    // 정답(세모) 클릭 시 커튼 개방
    function openCurtain() {
        document.querySelector('.captcha-box').style.transform = 'scale(0.5) rotate(20deg)';
        document.querySelector('.captcha-box').style.opacity = '0';
        
        setTimeout(() => {
            document.getElementById('scene-intro').style.display = 'none';
            document.getElementById('curtain-left').classList.add('open-left');
            document.getElementById('curtain-right').classList.add('open-right');
            currentScene = 'lobby'; // 씬 변경
        }, 500);
    }

    // 토끼굴 클릭 시 노란장판 룸으로 추락
    function fallToRoom() {
        currentScene = 'room'; // 씬 변경 (박수 중단)
        const lobby = document.getElementById('scene-lobby');
        lobby.style.transform = 'scale(0.1) rotate(360deg)';
        lobby.style.opacity = '0';
        
        setTimeout(() => {
            document.getElementById('scene-room').classList.add('room-active');
        }, 800);
    }

    // 로비로 돌아가기 (차원 복구)
    function returnToLobby() {
        currentScene = 'lobby'; // 씬 복구 (박수 재개)
        document.getElementById('scene-room').classList.remove('room-active');
        
        const lobby = document.getElementById('scene-lobby');
        lobby.style.transform = 'scale(1) rotate(0deg)';
        lobby.style.opacity = '1';
    }

    // 팝업 제어
    function openPopup(id) { 
        document.getElementById(id).style.display = 'block'; 
        if(!CKEDITOR.instances['post-content']) {
            CKEDITOR.replace('post-content', { 
                height: 250, 
                language: 'ko',
                toolbar: [
                    { name: 'document', items: [ 'Source' ] },
                    { name: 'styles', items: [ 'Font', 'FontSize', 'Format', 'TextColor', 'BGColor' ] },
                    { name: 'basicstyles', items: [ 'Bold', 'Italic', 'Underline', 'Strike' ] },
                    { name: 'paragraph', items: [ 'NumberedList', 'BulletedList', 'Blockquote', 'JustifyLeft', 'JustifyCenter', 'JustifyRight' ] },
                    { name: 'insert', items: [ 'Image', 'Flash', 'Table', 'HorizontalRule', 'SpecialChar' ] },
                    { name: 'links', items: [ 'Link', 'Unlink' ] }
                ]
            });
        }
    }
    function closePopup(id) { document.getElementById(id).style.display = 'none'; }

    // 팝업 드래그
    function makeDraggable(winId) { 
        const win = document.getElementById(winId); const dragArea = win.querySelector('.alice-header'); if(!dragArea) return;
        let p1=0, p2=0, p3=0, p4=0; 
        dragArea.onmousedown = (e) => { e.preventDefault(); p3=e.clientX; p4=e.clientY; document.onmouseup = () => { document.onmouseup=null; document.onmousemove=null; }; document.onmousemove = (e) => { e.preventDefault(); p1=p3-e.clientX; p2=p4-e.clientY; p3=e.clientX; p4=e.clientY; win.style.top=(win.offsetTop-p2)+"px"; win.style.left=(win.offsetLeft-p1)+"px"; }; }; 
    }
    makeDraggable('write-window');

</script>
</body>
</html>
