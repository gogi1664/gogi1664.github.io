<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>The Ultimate DIY Nostalgia</title>
  <link href="https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

  <style>
    /* === ğŸ©¸ ê¸°ë³¸ ì„¤ì • === */
    body { background-color: #000; color: #ccc; font-family: 'Galmuri9', 'ê¶ì„œ', serif; margin: 0; padding: 0; overflow: hidden; cursor: crosshair; }
    #world-container { position: absolute; top: 0; left: 80px; width: calc(100vw - 80px); height: 100vh; overflow: hidden; }
    .world-view { display: none; width: 100%; height: 100%; position: relative; }
    .world-view.active { display: block; }

    /* === ğŸ’» ì¢Œì¸¡ ì‹œìŠ¤í…œ ë©”ë‰´ë°” === */
    #left-taskbar { position: fixed; top: 0; left: 0; width: 80px; height: 100vh; background: #1a1a1a; border-right: 4px solid #000; display: flex; flex-direction: column; align-items: center; padding-top: 30px; z-index: 1000; }
    .task-icon { width: 60px; margin-bottom: 25px; text-align: center; cursor: pointer; font-size: 10px; color: #888; transition: 0.2s; display: flex; flex-direction: column; align-items: center;}
    .task-block { width: 30px; height: 30px; background: #555; border: 3px solid #000; margin-bottom: 5px; transition: 0.2s; display: flex; justify-content: center; align-items: center; color: #000; font-weight: bold; font-size: 8px;}
    .task-icon:hover { color: #fff; } .task-icon:hover .task-block { background: #f1c40f; transform: scale(1.1); color:#000; }

    /* =========================================
       [ì°¨ì› 1] ë¡œë¹„: ë…¸ë€ì¥íŒ ì§€ì˜¥
       ========================================= */
    #view-room { background: linear-gradient(to bottom, #eee 0%, #ddd 50%, #dcb35a 50%, #b28936 100%); }
    
    .diy-obj { position: absolute; z-index: 10; pointer-events: none; filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.4)); object-fit: contain; }
    .obj-window { top: 8%; left: 35%; width: 220px; height: 220px; }
    .obj-closet { bottom: 40%; right: 8%; width: 160px; height: 300px; }
    .obj-bedding { bottom: 8%; left: 8%; width: 400px; height: 200px; z-index: 20; }
    .obj-mold { position: absolute; bottom: 45%; left: 5%; width: 300px; height: 300px; background: radial-gradient(circle, rgba(0,0,0,0.4) 0%, rgba(0,0,0,0) 70%); z-index: 1; pointer-events: none; mix-blend-mode: multiply; }
    
    .light-switch { position: absolute; top: 30%; left: 3%; width: 35px; height: 55px; background: #ddd; border: 3px solid #555; cursor: pointer; z-index: 100; box-shadow: 3px 3px 5px rgba(0,0,0,0.3); display: flex; justify-content: center; align-items: center; }
    .switch-knob { width: 15px; height: 30px; background: #fff; border: 2px solid #777; transition: 0.1s;}
    .light-switch:active .switch-knob { transform: translateY(5px); }
    @keyframes flicker { 0%, 100% { filter: brightness(1); } 10%, 25% { filter: brightness(0.1); } 15% { filter: brightness(1.2); } }
    .room-flicker { animation: flicker 0.6s linear; }

    .main-pic-container { position:absolute; top:12%; left:5%; width:28%; height:42%; background:#000; border:5px solid #4e342e; z-index:15; transform:rotate(-2deg); overflow:hidden; box-shadow: 10px 10px 20px rgba(0,0,0,0.5); }
    #main-visual-img { width:100%; height:100%; object-fit:cover; background: #222; }

    /* =========================================
       [ì°¨ì› 2] ê¸°ì°¨ì—­ (ì¶˜ì²œí–‰) 
       ========================================= */
    #view-station { background: linear-gradient(to bottom, #1a2a6c, #b21f1f, #fdbb2d); overflow: hidden; }
    .station-fog { position: absolute; width: 200%; height: 100%; background: repeating-linear-gradient(45deg, rgba(255,255,255,0.1) 0px, rgba(255,255,255,0.1) 10px, transparent 10px, transparent 20px); opacity: 0.3; animation: fogMove 80s linear infinite; pointer-events: none; filter: blur(5px);}
    @keyframes fogMove { from { transform: translateX(0); } to { transform: translateX(-50%); } }
    .chimney { position: absolute; bottom: 35%; right: 20%; width: 60px; height: 200px; background: #34495e; border: 4px solid #2c3e50; }
    .smoke { position: absolute; top: -20px; left: 50%; width: 20px; height: 20px; background: rgba(200,200,200,0.5); border: 2px solid rgba(255,255,255,0.3); animation: smokeRise 5s infinite; }
    @keyframes smokeRise { 0% { transform: translate(-50%, 0) scale(1) rotate(0deg); opacity: 0.7; } 100% { transform: translate(80px, -250px) scale(4) rotate(180deg); opacity: 0; } }
    .train-block { position: absolute; bottom: 18%; left: -600px; z-index: 50; animation: trainRun 25s linear infinite; animation-delay: 3s;}
    @keyframes trainRun { 0% { left: -600px; } 100% { left: 120%; } }
    .man-block { position: absolute; bottom: 15%; left: 40%; opacity: 0.6; animation: manWalk 20s ease-in-out infinite;}
    @keyframes manWalk { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(60px); } }
    .railroad { position:absolute; bottom:0; width:100%; height:150px; background:repeating-linear-gradient(90deg, #111 0, #111 20px, transparent 20px, transparent 60px), #3e2723; border-top:8px solid #2c3e50; transform:perspective(500px) rotateX(45deg); }

    /* =========================================
       [ì°¨ì› 3] ì•„ì¿ ì•„ë¦¬ì›€ 
       ========================================= */
    #view-aqua { background: linear-gradient(to bottom, #001f3f, #0074d9); overflow: hidden; }
    .aqua-block { position: absolute; pointer-events: none; z-index: 5; animation: floatSwim linear infinite; filter: drop-shadow(5px 5px 10px rgba(0,0,0,0.6));}
    @keyframes floatSwim { 0% { transform: translateX(0) rotate(5deg); } 100% { transform: translateX(120vw) rotate(-5deg); } }

    /* === ğŸ¬ ë²„íŠ¼ ë° í”½ì…€ ë¸”ë¡ ê³µí†µ ìŠ¤íƒ€ì¼ === */
    .obj-btn {
        position: absolute; background: transparent; border: none; 
        color: #fff; font-family: 'Galmuri9'; font-weight: bold;
        display: flex; flex-direction: column; align-items: center; cursor: pointer;
        z-index: 150 !important; transition: 0.2s; text-shadow: 2px 2px 0px #000; outline: none;
    }
    .obj-btn .code-pixel-block { transition: 0.1s; }
    .obj-btn:hover .code-pixel-block { transform: scale(1.15) rotate(5deg); }
    .obj-btn:active { transform: scale(0.9); }

    /* ğŸ“Œ ê¸°ë³¸ ëŒ€ì²´ì œ: ì‚¬ìš©ìê°€ ê·¸ë¦¼ì„ ì˜¬ë¦¬ê¸° ì „ê¹Œì§€ ë³´ì—¬ì§€ëŠ” 'ë¹ˆ ìƒì' */
    .code-pixel-block {
        display: flex; justify-content: center; align-items: center; text-align: center; 
        font-size: 10px; color: #fff; font-weight: bold; border: 4px solid #000; box-shadow: 4px 4px 0px rgba(0,0,0,0.5); 
        image-rendering: pixelated; overflow: hidden; word-break: break-all; padding: 2px;
    }
    
    /* ê° ìƒìë³„ ê¸°ë³¸ í¬ê¸°ì™€ ìƒ‰ìƒ */
    .cp-diary { width: 40px; height: 50px; background: #27ae60; } 
    .cp-char  { width: 50px; height: 35px; background: #2980b9; } 
    .cp-review{ width: 55px; height: 35px; background: #c0392b; } 
    .cp-write { width: 20px; height: 60px; background: #f1c40f; color:#000;} 
    .cp-verify{ width: 40px; height: 40px; background: #e67e22; border-radius: 50%; } 
    .cp-shop  { width: 45px; height: 55px; background: #8e44ad; } 
    .cp-post  { width: 60px; height: 80px; background: #c0392b; border: 4px solid #7f1d1d;} 
    .cp-train { width: 120px; height: 50px; background: #34495e; border: 4px solid #2c3e50;} 
    .cp-man   { width: 30px; height: 60px; background: #7f8c8d; } 
    .cp-fish  { width: 60px; height: 30px; background: #3498db; border-radius: 30px;} 
    .cp-game  { width: 80px; height: 80px; background: #16a085; border: 4px solid #0e6655;} 
    .cp-gear  { width: 40px; height: 40px; background: #95a5a6; border-radius: 50%;} 

    /* ë²„íŠ¼ ìœ„ì¹˜ ë°°ì¹˜ */
    .btn-diary  { top: 55%; left: 45%; } 
    .btn-char   { top: 75%; left: 30%; } 
    .btn-review { top: 60%; left: 68%; } 
    .btn-write  { top: 82%; left: 52%; } 
    .btn-verify { top: 18%; right: 12%; } 
    .btn-shop   { top: 78%; left: 82%; } 
    .btn-setting{ bottom: 5%; right: 5%; } 
    .btn-post   { bottom: 12%; right: 12%; }

    /* === ğŸ’» íŒì—…ì°½ ê³µí†µ ë””ìì¸ === */
    .cute-popup { position: absolute; display: none; background: rgba(15,15,15,0.98); border: 4px solid #000; box-shadow: 15px 15px 0px rgba(0,0,0,0.7); overflow: hidden; width: 450px; color: #ddd; z-index: 2000; image-rendering: pixelated; }
    .cute-titlebar { background: #333; color: #fff; padding: 10px; font-size: 12px; border-bottom: 4px solid #000; display: flex; justify-content: space-between; align-items: center; cursor: grab; }
    .cute-body { padding: 15px; max-height: 65vh; overflow-y: auto; background: #222;}
    .close-x { cursor: pointer; color: #fff; background: #c0392b; padding: 2px 6px; border: 2px solid #000; font-weight: bold;}
    .close-x:hover { background: #ff0000; }
    .cute-input { width: 100%; padding: 8px; margin-bottom: 10px; background: #000; border: 3px solid #555; color: #fff; font-family: 'Galmuri9'; box-sizing: border-box; outline: none;}
    .btn-action { background: #333; color: #fff; border: 3px solid #000; padding: 8px 15px; font-family: 'Galmuri9'; cursor: pointer; transition: 0.1s; box-shadow: 2px 2px 0 #000;}
    .btn-action:hover { background: #f1c40f; color: #000;}
    .btn-action:active { transform: translate(2px, 2px); box-shadow: none;}

    /* ì„¤ì •ì°½ íƒ­ ë©”ë‰´ */
    .setup-tabs { display: flex; border-bottom: 2px solid #555; margin-bottom: 10px; }
    .setup-tab { padding: 5px 10px; cursor: pointer; background: #111; border: 1px solid #555; border-bottom: none; margin-right: 5px; color: #888; font-size: 11px;}
    .setup-tab.active { background: #f1c40f; color: #000; font-weight: bold; border-color: #f1c40f; }
    .setup-content { display: none; }
    .setup-content.active { display: block; }
    .file-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; border-bottom: 1px dashed #444; padding-bottom: 5px;}
    .file-row label { font-size: 11px; color: #ccc; }
    .file-row input[type="file"] { width: 180px; font-size: 10px; color: #f1c40f;}

    /* ê²Œì‹œíŒ ë¦¬ìŠ¤íŠ¸ */
    .post-item { margin-bottom: 10px; border: 3px solid #000; background: #333; color: #ccc;}
    .post-header { padding: 10px 12px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: pointer; border-bottom: 3px solid #000;}
    .post-header:hover { background: #444; color: #fff; }
    .post-content-area { padding: 15px; display: none; background: #222; font-size: 12px; line-height: 1.6; border-top: 3px solid #000;}

    /* ëŒê³ ë˜ & ì‹œë©”ì§€ */
    #dolphin-game-area { width: 300px; height: 350px; background: #001a1a; border: 6px solid #004d40; margin: 0 auto; position: relative; overflow: hidden; }
    .ring { width: 24px; height: 24px; border: 6px solid; border-radius: 50%; position: absolute; box-shadow: 3px 3px 0px rgba(0,0,0,0.5);}
    .post { width: 14px; height: 130px; background: #5d4037; border: 3px solid #3e2723; position: absolute; bottom: 0; box-shadow: 4px 0 0px rgba(0,0,0,0.5);}
    #dolphin-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:100; color:#fff;}
    #shimeji-room { position: absolute; bottom: 22%; right: 8%; z-index: 999; text-align: center; cursor: grab; transition: top 1s, left 1s; }
    .css-pet { width: 60px; height: 60px; background: #fff; border: 4px solid #000; display: flex; justify-content: center; align-items: center; font-weight: bold; color: #000; box-shadow: 5px 5px 0px rgba(0,0,0,0.5); cursor: pointer; background-size: contain; background-repeat: no-repeat; background-position: center; font-size: 12px;}
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    .is-walking { animation: bounce 0.3s infinite; }
    
    #item-drop-zone { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; overflow: hidden;}
    .dropped-item { position: absolute; font-size: 20px; filter: drop-shadow(3px 3px 0px #000); animation: itemFall 0.8s forwards; }
    @keyframes itemFall { 0% { transform: translateY(-100px) rotate(-360deg); opacity:0; } 100% { transform: translateY(0) rotate(0deg); opacity:1; } }
  </style>
</head>
<body id="main-body">

  <div id="world-container">
      
      <div id="view-room" class="world-view active">
          <div id="item-drop-zone"></div>
          
          <img id="diy-window" class="diy-obj obj-window" alt="ğŸªŸ">
          <img id="diy-closet" class="diy-obj obj-closet" alt="ğŸšª">
          <img id="diy-bedding" class="diy-obj obj-bedding" alt="ğŸ›ï¸">
          <div class="obj-mold"></div>
          
          <div class="light-switch" onclick="flickerRoom()"> <div class="switch-knob"></div> </div>

          <div class="main-pic-container">
              <img id="main-visual-img" alt="ğŸ–¼ï¸">
          </div>

          <button class="obj-btn btn-diary" onclick="openBoard('diary')">
              <div class="code-pixel-block cp-diary" id="icon-diary">ì¼ê¸°ì¥</div>
              <span style="color:#2ecc71;">ë¹„ë°€ ì¼ê¸°</span>
          </button>
          
          <button class="obj-btn btn-char" onclick="openBoard('character')">
              <div class="code-pixel-block cp-char" id="icon-char">ì‹ ë¶„ì¦</div>
              <span style="color:#3498db;">ìºë¦­í„° ë±</span>
          </button>
          
          <button class="obj-btn btn-review" onclick="openBoard('review')">
              <div class="code-pixel-block cp-review" id="icon-review">ë¹„ë””ì˜¤</div>
              <span style="color:#e74c3c;">ëª©ê²©ë‹´</span>
          </button>
          
          <button class="obj-btn btn-write" onclick="openWrite()">
              <div class="code-pixel-block cp-write" id="icon-write">íœ</div>
              <span style="color:#f1c40f;">ê¸°ë¡í•˜ë¼</span>
          </button>
          
          <button class="obj-btn btn-verify" onclick="openPopup('captcha-window')">
              <div class="code-pixel-block cp-verify" id="icon-verify">ì•Œì•½</div>
              <span style="color:#e67e22;">ë³´ì•ˆ ì¸ì¦</span>
          </button>
          
          <button class="obj-btn btn-shop" onclick="openPopup('shop-window')">
              <div class="code-pixel-block cp-shop" id="icon-shop">ë´‰íˆ¬</div>
              <span style="color:#9b59b6;">ì•”ì‹œì¥</span>
          </button>
          
          <button class="obj-btn btn-setting" onclick="openPopup('profile-window')">
              <div class="code-pixel-block cp-gear" id="icon-gear">ì„¤ì •</div>
          </button>
      </div>

      <div id="view-station" class="world-view">
          <div class="station-fog"></div>
          <div style="position:absolute; top:25%; width:100%; text-align:center; color:#fff; font-size:28px; font-weight:bold; text-shadow: 4px 4px 0px #000;">ì¶˜ì²œí–‰ ê¸°ì°¨ëŠ” ë– ë‚˜ê³ ...</div>
          
          <div class="chimney">
              <div class="smoke" style="animation-delay:0s;"></div>
              <div class="smoke" style="animation-delay:1.5s;"></div>
          </div>
          
          <div class="train-block">
              <div class="code-pixel-block cp-train" id="icon-train">ê¸°ì°¨</div>
          </div>
          <div class="man-block">
               <div class="code-pixel-block cp-man" id="icon-man">í–‰ì¸</div>
          </div>
          
          <div class="railroad"></div>

          <button class="obj-btn btn-post" onclick="openBoard('guestbook')">
              <div class="code-pixel-block cp-post" id="icon-post">ìš°ì²´í†µ</div>
              <span style="color:#ffeb3b;">ì¶”ì–µì˜ ìš°ì²´í†µ</span>
          </button>
      </div>

      <div id="view-aqua" class="world-view">
          <div class="aqua-block" style="top:20%; left:-15%; animation-duration:20s;">
               <div class="code-pixel-block cp-fish" id="icon-fish1">ë¬¼ê³ ê¸°1</div>
          </div>
          <div class="aqua-block" style="top:55%; right:-15%; transform:scaleX(-1); animation-direction:reverse; animation-duration:30s;">
               <div class="code-pixel-block cp-fish" style="background:#e74c3c;" id="icon-fish2">ë¬¼ê³ ê¸°2</div>
          </div>
          
          <button class="obj-btn" style="top:50%; left:50%; transform:translate(-50%,-50%);" onclick="openPopup('dolphin-window')">
              <div class="code-pixel-block cp-game" id="icon-game">ì˜¤ë½ê¸°</div>
              <span style="font-size:20px; color:#00bcd4;">ì‹¬í•´ ì˜¤ë½ê¸°</span>
          </button>
      </div>

      <div id="shimeji-room">
          <div id="pet-bubble" style="background:#fff; border:3px solid #000; padding:4px; font-size:11px; opacity:0; transition:0.3s; margin-bottom:5px; color:#000; font-weight:bold;">ë°¥ ì¤˜...</div>
          <div id="pet-image" class="css-pet" onclick="openPopup('ai-window')" ondblclick="toggleRoaming()">( Âº â–² Âº )</div>
      </div>

  </div>

  <div id="left-taskbar">
      <div class="task-icon" onclick="switchWorld('view-room')"><div class="task-block" style="background:#dcb35a;">ë°©</div>Room</div>
      <div class="task-icon" onclick="switchWorld('view-station')"><div class="task-block" style="background:#34495e;">ì—­</div>Station</div>
      <div class="task-icon" onclick="switchWorld('view-aqua')"><div class="task-block" style="background:#3498db;">ë¬¼</div>Aqua</div>
      <hr style="width:50%; border-color:#333; margin:15px 0;">
      <div class="task-icon" onclick="openPopup('music-window')"><div class="task-block" style="background:#c0392b;">ìŒì•…</div>Music</div>
      <div class="task-icon" onclick="openPopup('ai-window')"><div class="task-block" style="background:#27ae60;">í†¡</div>Chat</div>
  </div>

  <div id="captcha-window" class="cute-popup">
      <div class="cute-titlebar"><span>âš ï¸ SECURITY</span><span class="close-x" onclick="closePopup('captcha-window')">X</span></div>
      <div class="cute-body" style="text-align:center;">
          <p>ë”°ëœ»í•œ ì¥íŒ ìƒ‰ì„ ê³ ë¥´ì‹œì˜¤.</p>
          <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:5px;">
              <div class="code-pixel-block" style="height:60px; background:#f1c40f; cursor:pointer; color:#000;" onclick="this.style.background='#fff'">ë…¸ë‘</div>
              <div class="code-pixel-block" style="height:60px; background:#dcb35a; cursor:pointer; color:#000;" onclick="this.style.background='#fff'">ì¥íŒìƒ‰</div>
              <div class="code-pixel-block" style="height:60px; background:#b28936; cursor:pointer; color:#000;" onclick="this.style.background='#fff'">ë˜¥ìƒ‰</div>
          </div>
          <button class="btn-action" style="margin-top:15px; width:100%;" onclick="closePopup('captcha-window')">ì¸ì¦ ì™„ë£Œ</button>
      </div>
  </div>

  <div id="music-window" class="cute-popup">
      <div class="cute-titlebar"><span>ğŸ“» CASSETTE</span><span class="close-x" onclick="closePopup('music-window')">X</span></div>
      <div class="cute-body" style="text-align:center;">
          <button class="btn-action" onclick="prevTrack()">â®</button>
          <button class="btn-action" onclick="togglePlay()">â–¶/â¸</button>
          <button class="btn-action" onclick="nextTrack()">â­</button>
          <marquee id="now-playing-text" style="margin-top:10px; color:#2ecc71; border:3px solid #000; padding:5px; background:#000;">Tape Waiting...</marquee>
      </div>
  </div>

  <div id="board-window" class="cute-popup">
      <div class="cute-titlebar"><span id="board-title">ğŸ€ Board</span><span class="close-x" onclick="closePopup('board-window')">X</span></div>
      <div class="cute-body" id="page-content">ë¡œë”© ì¤‘...</div>
  </div>

  <div id="write-window" class="cute-popup">
      <div class="cute-titlebar"><span>ğŸ“ WRITE</span><span class="close-x" onclick="closePopup('write-window')">X</span></div>
      <div class="cute-body">
          <select id="post-category" class="cute-input">
              <option value="diary">ë¹„ë°€ ì¼ê¸°</option>
              <option value="character">ìºë¦­í„° ë±</option>
              <option value="review">ëª©ê²©ë‹´</option>
              <option value="guestbook">ë°©ëª…ë¡</option>
          </select>
          <input type="text" id="post-title" class="cute-input" placeholder="ì œëª©...">
          <textarea id="post-content"></textarea>
          <div style="text-align:right; margin-top:15px;"><button class="btn-action" onclick="savePost()">ì €ì¥</button></div>
      </div>
  </div>

  <div id="ai-window" class="cute-popup">
      <div class="cute-titlebar"><span>ğŸ’¬ MESSENGER</span><span class="close-x" onclick="closePopup('ai-window')">X</span></div>
      <div class="cute-body">
          <div id="chat-log" style="height:200px; overflow-y:auto; background:#000; border:3px solid #555; padding:10px; font-size:12px;"></div>
          <div style="display:flex; gap:5px; margin-top:10px;">
              <input type="text" id="ai-input" class="cute-input" style="margin:0;" onkeypress="if(event.key==='Enter')sendMsg()">
              <button class="btn-action" onclick="sendMsg()">ì „ì†¡</button>
          </div>
      </div>
  </div>

  <div id="shop-window" class="cute-popup">
      <div class="cute-titlebar"><span>ğŸ›’ BLACK MARKET</span><span class="close-x" onclick="closePopup('shop-window')">X</span></div>
      <div class="cute-body" style="text-align:center;">
          <h3 id="my-money" style="color:#f1c40f;">0 P</h3>
          <div style="display:flex; gap:10px; justify-content:center;">
              <button class="btn-action" onclick="buyItem('ì†Œì£¼', 'ğŸ¾', 100)">ì†Œì£¼(100P)</button>
              <button class="btn-action" onclick="buyItem('ë‹´ë°°', 'ğŸš¬', 200)">ë‹´ë°°(200P)</button>
              <button class="btn-action" onclick="buyItem('ì¹¼', 'ğŸ”ª', 300)">ì¹¼(300P)</button>
          </div>
          <div style="text-align:right; margin-top:15px;"><button class="btn-action" style="background:#c0392b;" onclick="clearRoomItems()">ë°© ì²­ì†Œ</button></div>
      </div>
  </div>

  <div id="dolphin-window" class="cute-popup">
      <div class="cute-titlebar"><span>ğŸ¬ ARCADE</span><span class="close-x" onclick="closePopup('dolphin-window')">X</span></div>
      <div class="cute-body">
          <div id="dolphin-game-area">
              <div id="dolphin-overlay">
                  <div id="dolphin-msg" style="font-weight:bold; font-size:18px;">INSERT COIN</div>
                  <button id="dolphin-start-btn" class="btn-action" style="margin-top:15px; background:#00bcd4; color:#000;" onclick="startDolphinGame()">START</button>
              </div>
              <div class="post" style="left:60px;"></div><div class="post" style="right:60px;"></div>
              <div class="ring" id="ring0" style="border-color:#ff0000;"></div><div class="ring" id="ring1" style="border-color:#00ff00;"></div><div class="ring" id="ring2" style="border-color:#0000ff;"></div><div class="ring" id="ring3" style="border-color:#ffff00;"></div><div class="ring" id="ring4" style="border-color:#ff00ff;"></div>
          </div>
          <div style="display:flex; justify-content:space-between; margin-top:10px;"><button class="btn-action" onclick="pushRings('left')">â—€ L</button><button class="btn-action" onclick="pushRings('right')">R â–¶</button></div>
          <div id="d-score" style="text-align:center; font-weight:bold; margin-top:10px; color:#f1c40f;">ğŸ† 0ê°œ</div>
      </div>
  </div>

  <div id="profile-window" class="cute-popup" style="width: 500px;">
      <div class="cute-titlebar"><span>âš™ï¸ SETUP (ëª¨ë“  ì´ë¯¸ì§€ êµì²´ ê°€ëŠ¥)</span><span class="close-x" onclick="closePopup('profile-window')">X</span></div>
      <div class="cute-body">
          <p style="font-size:11px; color:#f1c40f; margin-top:0;">â€» íŒŒì¼ì„ ì²¨ë¶€í•˜ë©´ ì œê°€ ì•Œì•„ì„œ ì´ˆì†Œí˜• í™”ì§ˆë¡œ ì••ì¶•í•´ì„œ ìš©ëŸ‰ ì—ëŸ¬ë¥¼ ë§‰ìŠµë‹ˆë‹¤!! ì—¬ëŸ¬ ì¥ ë§˜ê» ì˜¬ë¦¬ì‹­ì‹œì˜¤!!</p>
          
          <div class="setup-tabs">
              <div class="setup-tab active" onclick="switchTab(1)">ê°€êµ¬/ë°°ê²½</div>
              <div class="setup-tab" onclick="switchTab(2)">ë¡œë¹„ ë²„íŠ¼</div>
              <div class="setup-tab" onclick="switchTab(3)">ê¸°ì°¨/ë°”ë‹¤</div>
          </div>

          <div id="setup-tab-1" class="setup-content active">
              <div class="file-row"><label>ğŸªŸ ì°½ë¬¸</label><input type="file" id="fi-window"></div>
              <div class="file-row"><label>ğŸšª ì˜·ì¥</label><input type="file" id="fi-closet"></div>
              <div class="file-row"><label>ğŸ›ï¸ ì´ë¶ˆ</label><input type="file" id="fi-bedding"></div>
              <div class="file-row"><label>ğŸ–¼ï¸ ì•¡ì</label><input type="file" id="fi-main"></div>
              <div class="file-row"><label>ğŸ¾ í«</label><input type="file" id="fi-pet"></div>
              <div class="file-row" style="margin-top:10px;"><label>ğŸµ BGM ID</label><input type="text" id="fi-bgm" class="cute-input" style="width:150px; margin:0;" placeholder="ìœ íŠœë¸Œ ID"></div>
          </div>

          <div id="setup-tab-2" class="setup-content">
              <div class="file-row"><label>ğŸ““ ì¼ê¸° ë²„íŠ¼</label><input type="file" id="fi-diary"></div>
              <div class="file-row"><label>ğŸªª ìºë¦­í„° ë²„íŠ¼</label><input type="file" id="fi-char"></div>
              <div class="file-row"><label>ğŸ“¼ ëª©ê²©ë‹´ ë²„íŠ¼</label><input type="file" id="fi-review"></div>
              <div class="file-row"><label>ğŸ–‹ï¸ ê¸°ë¡ ë²„íŠ¼</label><input type="file" id="fi-write"></div>
              <div class="file-row"><label>ğŸ’Š ì¸ì¦ ë²„íŠ¼</label><input type="file" id="fi-verify"></div>
              <div class="file-row"><label>ğŸ›ï¸ ì•”ì‹œì¥ ë²„íŠ¼</label><input type="file" id="fi-shop"></div>
              <div class="file-row"><label>âš™ï¸ ì„¤ì • ë²„íŠ¼</label><input type="file" id="fi-gear"></div>
          </div>

          <div id="setup-tab-3" class="setup-content">
              <div class="file-row"><label>ğŸš‚ ê¸°ì°¨</label><input type="file" id="fi-train"></div>
              <div class="file-row"><label>ğŸš¶ í–‰ì¸</label><input type="file" id="fi-man"></div>
              <div class="file-row"><label>ğŸ“® ìš°ì²´í†µ</label><input type="file" id="fi-post"></div>
              <div class="file-row"><label>ğŸŸ ë¬¼ê³ ê¸° 1</label><input type="file" id="fi-fish1"></div>
              <div class="file-row"><label>ğŸ  ë¬¼ê³ ê¸° 2</label><input type="file" id="fi-fish2"></div>
              <div class="file-row"><label>ğŸ•¹ï¸ ì˜¤ë½ê¸°</label><input type="file" id="fi-game"></div>
          </div>

          <div style="text-align:right; margin-top:15px;"><button class="btn-action" onclick="saveAllImages()">ì €ì¥ ë° ì ìš©í•˜ê¸°</button></div>
      </div>
  </div>

  <div id="yt-player-container" style="display:none;"></div>

  <script>
    let highestZ = 3000;
    const SB_URL = "https://kzgbqpodvpuoqovfsyrm.supabase.co";
    const SB_KEY = "sb_publishable_pdqE1Sc-4PSv3LQM9IsBcA_xJWeZwW-";
    const OPENROUTER_KEY = "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";
    let sbClient = null; 
    if (window.supabase) sbClient = window.supabase.createClient(SB_URL, SB_KEY);
    CKEDITOR.replace('post-content', { height: 200, language: 'ko', removeButtons: 'About', versionCheck: false });

    /* ì˜¤ë””ì˜¤ ë²„ê·¸ ë°©ì§€ ì™„ë£Œ */
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playClickSound() { if(audioCtx.state === 'suspended') audioCtx.resume(); const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'square'; osc.frequency.setValueAtTime(600, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1); gain.gain.setValueAtTime(0.05, audioCtx.currentTime); gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.1); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.1); }
    function playPopupSound() { if(audioCtx.state === 'suspended') audioCtx.resume(); const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain(); osc.type = 'sine'; osc.frequency.setValueAtTime(300, audioCtx.currentTime); osc.frequency.linearRampToValueAtTime(600, audioCtx.currentTime + 0.1); gain.gain.setValueAtTime(0.001, audioCtx.currentTime); gain.gain.linearRampToValueAtTime(0.1, audioCtx.currentTime + 0.05); gain.gain.linearRampToValueAtTime(0.001, audioCtx.currentTime + 0.1); osc.connect(gain); gain.connect(audioCtx.destination); osc.start(); osc.stop(audioCtx.currentTime + 0.1); }
    document.addEventListener('click', (e) => { if(e.target.closest('button') || e.target.closest('.task-icon') || e.target.closest('.light-switch')) playClickSound(); });

    function switchWorld(vid) { document.querySelectorAll('.world-view').forEach(e => e.classList.remove('active')); document.getElementById(vid).classList.add('active'); playPopupSound(); }
    function flickerRoom() { const r = document.getElementById('view-room'); r.classList.remove('room-flicker'); void r.offsetWidth; r.classList.add('room-flicker'); }
    function openPopup(id) { playPopupSound(); const el = document.getElementById(id); el.style.display = 'block'; el.style.zIndex = ++highestZ; }
    function closePopup(id) { document.getElementById(id).style.display = 'none'; }

    function makeDraggable(winId) { 
        const win = document.getElementById(winId); const dragArea = win.querySelector('.cute-titlebar'); if(!dragArea) return;
        let p1=0, p2=0, p3=0, p4=0; 
        win.onmousedown = () => win.style.zIndex = ++highestZ; 
        dragArea.onmousedown = (e) => { e.preventDefault(); p3=e.clientX; p4=e.clientY; document.onmouseup = () => { document.onmouseup=null; document.onmousemove=null; }; document.onmousemove = (e) => { e.preventDefault(); p1=p3-e.clientX; p2=p4-e.clientY; p3=e.clientX; p4=e.clientY; win.style.top=(win.offsetTop-p2)+"px"; win.style.left=(win.offsetLeft-p1)+"px"; }; }; 
    }
    ['write-window','board-window','ai-window','profile-window','shop-window','music-window','dolphin-window', 'captcha-window'].forEach(makeDraggable);
    const shimeji = document.getElementById('shimeji-room'); shimeji.onmousedown = () => { shimeji.style.zIndex = ++highestZ; }; shimeji.ondragstart = () => false;

    /* íƒ­ ë³€ê²½ */
    function switchTab(num) {
        document.querySelectorAll('.setup-tab').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.setup-content').forEach(e => e.classList.remove('active'));
        document.querySelectorAll('.setup-tab')[num-1].classList.add('active');
        document.getElementById('setup-tab-'+num).classList.add('active');
    }

    /* ğŸ”´ Canvas ìë™ ì••ì¶•ê¸° (ì´ê²Œ ìˆì–´ì•¼ ìš©ëŸ‰ ì•ˆ í„°ì§) */
    function compressImage(file, callback) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                let w = img.width; let h = img.height;
                // ìµœëŒ€ ë„ˆë¹„ 200pxë¡œ í™• ì¤„ì—¬ì„œ ì••ì¶•
                if (w > 200) { h *= 200/w; w = 200; }
                canvas.width = w; canvas.height = h;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, w, h);
                // webp í˜•ì‹ìœ¼ë¡œ í™”ì§ˆ 70% ì••ì¶• (ì—„ì²­ ê°€ë²¼ì›Œì§)
                callback(canvas.toDataURL('image/webp', 0.7));
            }
            img.src = e.target.result;
        }
        reader.readAsDataURL(file);
    }

    /* ì´ë¯¸ì§€ ë°ì´í„° ì €ì¥ìš© ê·¸ë¦‡ */
    const imageKeys = ['window','closet','bedding','main','pet','diary','char','review','write','verify','shop','gear','train','man','post','fish1','fish2','game'];
    let customImages = {};

    // 1. íŒŒì¼ ì˜¬ë¦´ ë•Œë§ˆë‹¤ ìë™ ì••ì¶•í•´ì„œ ë³€ìˆ˜ì— ë³´ê´€
    imageKeys.forEach(key => {
        const input = document.getElementById('fi-' + key);
        if(input) {
            input.addEventListener('change', e => {
                const file = e.target.files[0]; if(!file) return;
                compressImage(file, (base64) => {
                    customImages[key] = base64;
                    input.style.color = "#2ecc71"; // ì˜¬ë¦¬ë©´ ìƒ‰ìƒ ë°”ë€œ
                });
            });
        }
    });

    // 2. ì €ì¥ ë²„íŠ¼ ëˆ„ë¥¼ ë•Œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°•ì•„ë„£ìŒ
    function saveAllImages() {
        customImages['bgm'] = document.getElementById('fi-bgm').value;
        try {
            localStorage.setItem('ultimateRoomData', JSON.stringify(customImages));
            alert("ì €ì¥ ì™„ë£Œ!");
        } catch(e) {
            alert("ì €ì¥ ì‹¤íŒ¨! ì—¬ì „íˆ ìš©ëŸ‰ì´ í½ë‹ˆë‹¤.");
        }
        applyImagesToUI();
        closePopup('profile-window');
    }

    // 3. í˜ì´ì§€ ì¼¤ ë•Œ & ì €ì¥í•  ë•Œ UI ê»ë°ê¸°ë¥¼ ì§„ì§œ ì‚¬ì§„ìœ¼ë¡œ ë°”ê¾¸ëŠ” ë§ˆë²•
    function applyImagesToUI() {
        const saved = JSON.parse(localStorage.getItem('ultimateRoomData')) || {};
        customImages = saved; // ë™ê¸°í™”
        
        // ê°€êµ¬ ë° ì•¡ì
        if(saved.window) document.getElementById('diy-window').src = saved.window;
        if(saved.closet) document.getElementById('diy-closet').src = saved.closet;
        if(saved.bedding) document.getElementById('diy-bedding').src = saved.bedding;
        if(saved.main) document.getElementById('main-visual-img').src = saved.main;
        
        // í«
        const petEl = document.getElementById('pet-image');
        if(saved.pet) { petEl.style.backgroundImage = `url(${saved.pet})`; petEl.innerText = ''; } 
        else { petEl.style.backgroundImage = 'none'; petEl.innerText = '( Âº â–² Âº )'; }

        // ë²„íŠ¼ ì•„ì´ì½˜ë“¤ (í•µì‹¬)
        const btnKeys = ['diary','char','review','write','verify','shop','gear','train','man','post','fish1','fish2','game'];
        btnKeys.forEach(k => {
            if(saved[k]) {
                const iconDiv = document.getElementById('icon-' + k);
                if(iconDiv) {
                    // ì›ë˜ ìˆë˜ CSS ê»ë°ê¸° ë°•ì‚´ë‚´ê³  ì´ë¯¸ì§€ë§Œ ë”± ë‚¨ê¹€
                    iconDiv.style.background = 'transparent';
                    iconDiv.style.border = 'none';
                    iconDiv.style.boxShadow = 'none';
                    iconDiv.innerHTML = `<img src="${saved[k]}" style="width:100%; height:100%; object-fit:contain; filter:drop-shadow(3px 3px 0 rgba(0,0,0,0.8));">`;
                }
            }
        });

        currentPlaylist = (saved.bgm || 'VDMiHYgQKLE').split(',').map(x=>x.trim()).filter(x=>x);
        document.getElementById('fi-bgm').value = saved.bgm || '';
        if(player && player.loadVideoById && currentPlaylist.length > 0) loadMusicPlayer();
    }

    /* ì‹œì‘í•  ë•Œ ë¬´ì¡°ê±´ ì ìš© */
    applyImagesToUI();


    /* ê²Œì‹œíŒ ê¸°ëŠ¥ */
    let globalPostsData = [];
    async function openBoard(type) { 
        let title = 'ğŸ€ Board';
        if(type==='diary') title = 'ğŸ““ ë¹„ë°€ ì¼ê¸°'; else if(type==='character') title = 'âœ¨ ìºë¦­í„° ë±'; else if(type==='review') title = 'ğŸ¬ ëª©ê²©ë‹´'; else if(type==='guestbook') title = 'ğŸ“® ì¶”ì–µì˜ ë°©ëª…ë¡';
        document.getElementById('board-title').innerText = title; document.getElementById('page-content').innerHTML = 'ë¡œë”© ì¤‘...'; openPopup('board-window'); 
        if (!sbClient) { document.getElementById('page-content').innerHTML = 'DB ì—°ê²° ì˜¤ë¥˜...'; return; }
        const {data, error} = await sbClient.from('posts').select('*').eq('category', type).order('created_at',{ascending:false});
        if(error || !data || data.length === 0) { document.getElementById('page-content').innerHTML = 'í…… ë¹„ì–´ìˆë‹¤...'; return; }
        globalPostsData = data; let htmlStr = ''; 
        data.forEach(p => { 
            const dateStr = new Date(p.created_at).toLocaleDateString();
            htmlStr += `<div class="post-item"><div class="post-header" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='block'?'none':'block'"><span>ğŸ“‘ ${p.title} <small style="color:#888;">${dateStr}</small></span></div><div class="post-content-area">${p.content}</div></div>`; 
        });
        document.getElementById('page-content').innerHTML = htmlStr;
    }
    function openWrite() { document.getElementById('post-title').value = ''; CKEDITOR.instances['post-content'].setData(''); openPopup('write-window'); }
    async function savePost() { 
        if(!sbClient) return;
        const category = document.getElementById('post-category').value; const title = document.getElementById('post-title').value; const content = CKEDITOR.instances['post-content'].getData();
        if(!title.trim()) return alert("ì œëª©ì„ ì ì–´ë¼...");
        await sbClient.from('posts').insert([{title: title, content: content, category: category}]); 
        earnPoints(100); closePopup('write-window'); openBoard(category); 
    }

    /* ëŒê³ ë˜ ì•„ì¼€ì´ë“œ */
    const rings = [document.getElementById('ring0'),document.getElementById('ring1'),document.getElementById('ring2'),document.getElementById('ring3'),document.getElementById('ring4')];
    let rState = [], dTime=30, dScore=0, dState='ready', dTimer=null, gameLoop=null;
    function resetRings() { rState = rings.map((r,i) => ({ x: 40+(i*50), y: 300, vy:0, vx:0, stuck:false, scored:false })); rings.forEach((r,i) => { r.style.top='300px'; r.style.left=rState[i].x+'px'; }); }
    function startDolphinGame() { dState='playing'; dTime=30; dScore=0; document.getElementById('d-score').innerText='ğŸ† 0ê°œ'; document.getElementById('dolphin-overlay').style.display='none'; resetRings(); if(dTimer) clearInterval(dTimer); dTimer=setInterval(()=>{ dTime--; if(dTime<=0) endGame(false); }, 1000); if(!gameLoop) loop(); }
    function loop() { 
        if(dState!=='playing') return; 
        rState.forEach((s,i) => { 
            if(s.stuck) return; 
            s.vy+=0.35; s.y+=s.vy; s.x+=s.vx; s.vx*=0.96; 
            if(s.y>300){ s.y=300; s.vy*=-0.5; } if(s.x<10||s.x>270) s.vx*=-0.8; 
            if(s.y>170 && s.y<240 && s.vy>0){ 
                if(Math.abs(s.x-60)<15 || Math.abs(s.x-240)<15){ 
                    s.stuck=true; s.y=250-(dScore*10); s.x=Math.abs(s.x-60)<15?60:240; 
                    if(!s.scored){ s.scored=true; dScore++; document.getElementById('d-score').innerText=`ğŸ† ${dScore}ê°œ`; } 
                } 
            } 
            rings[i].style.top=s.y+'px'; rings[i].style.left=s.x+'px'; 
        }); 
        if(dScore>=5) { endGame(true); return; } gameLoop=requestAnimationFrame(loop); 
    }
    function pushRings(dir) { if(dState==='playing') { rState.forEach(s => { if(!s.stuck){ s.vy = -Math.random()*8-3; s.vx += (dir==='left'?1:-1)*(Math.random()*4+2); } }); } }
    function endGame(win) { dState='over'; clearInterval(dTimer); cancelAnimationFrame(gameLoop); gameLoop=null; document.getElementById('dolphin-overlay').style.display='flex'; document.getElementById('dolphin-msg').innerText = win ? 'âœ¨ SUCCESS âœ¨\n+100P' : 'FAILED\nGAME OVER'; document.getElementById('dolphin-start-btn').innerText = 'â–¶ RETRY'; if(win) earnPoints(100); }

    /* ì•”ì‹œì¥ */
    let cash = parseInt(localStorage.getItem('pts')||'1000'); let roomItems = JSON.parse(localStorage.getItem('roomItems')||'[]');
    function uCash() { document.getElementById('my-money').innerText = cash+' P'; localStorage.setItem('pts', cash); }
    function earnPoints(a) { cash+=a; uCash(); } uCash();
    function buyItem(n, icon, p) { if(cash<p) return alert("ìê¸ˆ ë¶€ì¡±..."); cash-=p; uCash(); const x = Math.floor(Math.random()*80)+10; const y = Math.floor(Math.random()*30)+60; roomItems.push({ icon: icon, x: x, y: y }); localStorage.setItem('roomItems', JSON.stringify(roomItems)); renderRoomItems(); }
    function renderRoomItems() { const layer = document.getElementById('item-drop-zone'); layer.innerHTML=''; roomItems.forEach(item => { const el = document.createElement('div'); el.className='dropped-item code-pixel-block'; el.style.left=item.x+'%'; el.style.top=item.y+'%'; el.innerText=item.icon; el.style.background = '#8e44ad'; layer.appendChild(el); }); }
    function clearRoomItems() { roomItems=[]; localStorage.setItem('roomItems','[]'); renderRoomItems(); } renderRoomItems();

    /* AI í« */
    async function sendMsg() { 
        const i = document.getElementById('ai-input'), l = document.getElementById('chat-log'), t = i.value.trim(); if(!t) return; 
        l.innerHTML += `<div class="msg-row msg-me">${t}</div>`; i.value = ''; l.scrollTop = l.scrollHeight; 
        try {
            const res = await fetch("https://openrouter.ai/api/v1/chat/completions", { method:"POST", headers:{"Authorization":`Bearer ${OPENROUTER_KEY}`,"Content-Type":"application/json"}, body:JSON.stringify({ "model":"mistralai/mistral-7b-instruct:free", "messages":[{"role":"system","content":"í”¼íí•œ ë‹¤ë§ˆê³ ì¹˜ í«ì´ë‹¤. ë°˜ë§ë¡œ ì§§ê²Œ ëŒ€ë‹µí•´ë¼."},{"role":"user","content":t}] }) }); 
            const d = await res.json(); 
            if(d.choices && d.choices.length > 0) {
                l.innerHTML += `<div class="msg-row msg-ai">ë‚˜ë£¨: ${d.choices[0].message.content}</div>`; 
                const bubble = document.getElementById('pet-bubble'); bubble.innerText = d.choices[0].message.content; bubble.style.opacity = '1'; setTimeout(() => bubble.style.opacity = '0', 3000);
            }
        } catch(e) { l.innerHTML += `<div style="color:#f00; font-size:10px; text-align:center;">í†µì‹  ì˜¤ë¥˜...</div>`; }
        l.scrollTop = l.scrollHeight; 
    }
    let isRoaming = false; let roamInterval;
    function toggleRoaming() { 
        isRoaming = !isRoaming; const petRoom = document.getElementById('shimeji-room'); const petImg = document.getElementById('pet-image'); 
        if(isRoaming) { roamInterval = setInterval(() => { petImg.classList.add('is-walking'); petRoom.style.left = Math.floor(Math.random()*80) + '%'; petRoom.style.bottom = Math.floor(Math.random()*30) + '%'; setTimeout(() => petImg.classList.remove('is-walking'), 1500); }, 3000); } else { clearInterval(roamInterval); petImg.classList.remove('is-walking'); } 
    }

    /* ìœ íŠœë¸Œ ìŒì•…ê¸° */
    let player = null; let trackIndex = 0; let isPlayerReady = false; 
    let tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api"; document.head.appendChild(tag);
    window.onYouTubeIframeAPIReady = function() { 
        if(currentPlaylist.length === 0) return; 
        player = new YT.Player('yt-player-container', { height: '0', width: '0', videoId: currentPlaylist[trackIndex], events: { 'onReady': () => { isPlayerReady = true; document.getElementById('now-playing-text').innerText = "Tape Ready"; }, 'onStateChange': onPlayerStateChange, 'onError': nextTrack } }); 
    }
    function loadMusicPlayer() { if(!isPlayerReady || currentPlaylist.length === 0) return; player.loadVideoById(currentPlaylist[trackIndex]); }
    function onPlayerStateChange(event) { if(event.data === YT.PlayerState.ENDED) nextTrack(); if(event.data === YT.PlayerState.PLAYING) { document.getElementById('now-playing-text').innerText = "â–¶ " + (player.getVideoData().title || "Playing..."); } }
    function togglePlay() { if(!isPlayerReady) return; if(player.getPlayerState() === YT.PlayerState.PLAYING) player.pauseVideo(); else player.playVideo(); } 
    function nextTrack() { if(!isPlayerReady) return; trackIndex = (trackIndex + 1) % currentPlaylist.length; player.loadVideoById(currentPlaylist[trackIndex]); } 
    function prevTrack() { if(!isPlayerReady) return; trackIndex = (trackIndex - 1 + currentPlaylist.length) % currentPlaylist.length; player.loadVideoById(currentPlaylist[trackIndex]); }
  </script>
</body>
</html>
