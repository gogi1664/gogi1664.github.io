<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>The Interactive Nostalgia</title>
  <link href="https://cdn.jsdelivr.net/npm/galmuri@latest/dist/galmuri.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>

  <style>
    /* === ğŸ©¸ ê¸°ë³¸ ì„¤ì • === */
    body { background-color: #fdfdfd; color: #333; font-family: 'Galmuri9', sans-serif; margin: 0; padding: 0; overflow: hidden; user-select: none; }
    
    /* === ğŸ’» ì¢Œì¸¡ ë©”ë‰´ë°” (ì•„ë³´ì¹´ë„ì‹ íˆ¬ëª…/í™”ì´íŠ¸ ê°ì„±) === */
    #left-taskbar { position: fixed; top: 0; left: 0; width: 80px; height: 100vh; background: rgba(255, 255, 255, 0.85); border-right: 1px solid #eaeaea; backdrop-filter: blur(10px); display: flex; flex-direction: column; align-items: center; padding-top: 40px; z-index: 9999; box-shadow: 2px 0 10px rgba(0,0,0,0.02); }
    .task-icon { width: 60px; margin-bottom: 30px; text-align: center; cursor: pointer; font-size: 11px; color: #999; transition: 0.3s; }
    .task-icon div { font-size: 26px; margin-bottom: 8px; filter: grayscale(0.8); transition: 0.3s;}
    .task-icon:hover { color: #d81b60; } .task-icon:hover div { filter: grayscale(0); transform: translateY(-3px); }

    /* === ğŸ–¼ï¸ ì¤‘ì•™ ìº”ë²„ìŠ¤ ë˜í¼ === */
    #world-container { position: absolute; top: 0; left: 80px; width: calc(100vw - 80px); height: 100vh; overflow: hidden; background: #faf9f7; }
    .world-view { display: none; width: 100%; height: 100%; position: relative; }
    .world-view.active { display: block; }

    /* =========================================
       [ì°¨ì› 1] ì£¼ì¸ì˜ ì„¤ê³„ë„: ê¸°ë¯¹ ë£¸
       ========================================= */
    #view-room { 
        background: linear-gradient(to bottom, rgba(139, 0, 0, 0.9) 0%, rgba(210, 105, 30, 0.8) 40%, #cda043 40%, #9e7a2f 100%),
                    url('https://www.transparenttextures.com/patterns/floral-pattern.png');
        background-size: cover; background-position: center;
        position: relative; transition: filter 0.3s ease;
    }
    
    #room-darkness { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); pointer-events: none; z-index: 900; transition: 0.3s; opacity: 0; }
    .is-dark #room-darkness { opacity: 1; }
    
    #scene-light { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 150px; height: 60px; background: rgba(255,255,255,0.9); border-radius: 50%; box-shadow: 0 0 80px #fff, 0 0 20px #ffeb3b; cursor: pointer; z-index: 1000; border: 4px solid #fff; display: flex; justify-content: center; align-items: flex-end; padding-bottom: 5px; color: #555; font-size: 12px; font-weight: bold;}
    #scene-light:active { background: #fff; transform: translateX(-50%) scale(0.95); }

    /* ğŸªŸ ê¸°ë¯¹: ì°½ë¬¸ & ì‚¬ì„  ë¹› */
    #scene-window { position: absolute; top: 15%; right: 10%; width: 220px; height: 320px; border: 15px solid #fff; background: rgba(255, 200, 200, 0.6); cursor: pointer; z-index: 20; box-shadow: inset 0 0 20px rgba(0,0,0,0.1), 10px 10px 15px rgba(0,0,0,0.2); display: flex; justify-content: center; align-items: center; flex-direction: column; font-size: 16px; color: #333; font-weight: bold; border-radius: 10px;}
    #scene-window:hover { filter: brightness(1.1); transform: scale(1.02); }
    #window-pot { width: 80px; height: 60px; background: #fff; border-radius: 10px; border: 3px solid #eee; margin-bottom: 10px; font-size: 30px; display:flex; justify-content:center; align-items:center; box-shadow: 0 5px 10px rgba(0,0,0,0.1);}
    #waterfall { position: absolute; bottom: -250px; right: 20px; width: 180px; height: 250px; background: linear-gradient(to bottom, rgba(150, 200, 255, 0.4), rgba(150, 200, 255, 0.8)); animation: flow 1s infinite linear; pointer-events: none;}
    @keyframes flow { 0% { background-position: 0 0; } 100% { background-position: 0 100px; } }
    #water-puddle { position: absolute; bottom: -270px; right: -40px; width: 350px; height: 80px; background: rgba(150, 200, 255, 0.7); border-radius: 50%; transform: scaleY(0.4); pointer-events: none;}
    #light-beam { position: absolute; top: 15%; right: 10%; width: 60%; height: 80%; background: linear-gradient(120deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.05) 50%, transparent 80%); clip-path: polygon(100% 0, 100% 40%, 0 100%, 0 60%); z-index: 15; pointer-events: none; mix-blend-mode: overlay; }

    /* ğŸ¦â€â¬› ê¸°ë¯¹: ì „ë´‡ëŒ€ì™€ ê¹Œë§ˆê·€ */
    #scene-pole { position: absolute; top: 10%; left: 15%; width: 20px; height: 350px; background: #444; z-index: 10; border-radius: 10px;}
    #scene-wire { position: absolute; top: 20%; left: -5%; width: 50%; height: 2px; background: #555; z-index: 9; transform: rotate(5deg);}
    .crow { position: absolute; top: -25px; font-size: 28px; cursor: pointer; transition: 1s cubic-bezier(0.25, 1, 0.5, 1); z-index: 15; filter: drop-shadow(2px 2px 0 rgba(0,0,0,0.2));}
    #crow1 { left: 40%; } #crow2 { left: 55%; } #crow3 { left: 70%; }
    .crow.fly { transform: translate(500px, -500px) scale(2); opacity: 0; pointer-events: none; }

    /* ğŸ‘¤ ê¸°ë¯¹: ìºë¦­í„° ê·¸ë¦¼ì */
    #scene-character { position: absolute; bottom: 35%; left: 40%; width: 120px; height: 280px; background: #333; border-radius: 60px 60px 15px 15px; cursor: pointer; z-index: 50; filter: drop-shadow(10px 10px 15px rgba(0,0,0,0.3)); transition: 0.2s; display: flex; justify-content: center; align-items: center; color: #fff; font-weight: bold; background-position: center; background-repeat: no-repeat; background-size: contain;}
    #scene-character:hover { transform: scale(1.05) translateY(-5px); }
    #scene-character:active { transform: scale(0.95); }

    /* ğŸª´ ê¸°ë¯¹: ê¹¨ì§€ëŠ” í™”ë¶„ë“¤ */
    .scene-pot { position: absolute; cursor: pointer; z-index: 60; transition: 0.2s; display: flex; flex-direction: column; align-items: center; filter: drop-shadow(3px 3px 5px rgba(0,0,0,0.2));}
    .scene-pot .plant { font-size: 70px; margin-bottom: -15px; z-index: 61; transition: 0.3s; }
    .scene-pot .base { width: 80px; height: 80px; background: #fff; border-radius: 10px 10px 40px 40px; z-index: 62; box-shadow: inset -5px -5px 15px rgba(0,0,0,0.05);}
    #pot1 { bottom: 20%; left: 35%; } 
    #pot2 { bottom: 45%; left: 20%; } 
    .scene-pot.broken .plant { opacity: 0; transform: translateY(50px) rotate(45deg); pointer-events: none; }
    .scene-pot.broken .base { background: transparent; box-shadow: none; font-size: 60px; line-height: 80px; }

    /* ğŸ›ï¸ ê±°ëŒ€ ì´ë¶ˆ (ê²Œì‹œíŒ/ì¼ê¸°ì¥ ì—­í• ) */
    #scene-bed { position: absolute; bottom: -5%; left: 5%; width: 35%; height: 40%; background: #ffe4e1; border-radius: 30px 30px 0 0; border: 4px solid #fff; z-index: 40; box-shadow: 10px 10px 20px rgba(0,0,0,0.15); cursor: pointer; display: flex; justify-content: center; align-items: center; font-size: 20px; color: #d81b60; font-weight: bold; transform: perspective(800px) rotateX(30deg) rotateZ(-10deg); transition: 0.3s; background-size: cover; background-position: center;}
    #scene-bed:hover { transform: perspective(800px) rotateX(30deg) rotateZ(-10deg) translateY(-15px); }
    #scene-pillow { position: absolute; top: 10%; left: 10%; width: 140px; height: 70px; background: #fff; border-radius: 35px; box-shadow: 2px 2px 10px rgba(0,0,0,0.05); transform: rotate(10deg); }

    /* =========================================
       ğŸ€ ì•„ë³´ì¹´ë„ ê°ì„± UI (íŒì—…ì°½)
       ========================================= */
    .cute-popup { position: absolute; display: none; background: #fff; border: 1px solid #eee; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); overflow: hidden; width: 500px; color: #444; z-index: 2000; }
    .cute-titlebar { background: #fff; color: #888; padding: 15px 20px; font-size: 13px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; cursor: grab; border-bottom: 1px solid #f0f0f0; letter-spacing: 1px;}
    .cute-body { padding: 25px; max-height: 65vh; overflow-y: auto; background: #faf9f7;}
    
    /* ìŠ¤í¬ë¡¤ë°” ê°ì„± ì»¤ìŠ¤í…€ */
    .cute-body::-webkit-scrollbar { width: 8px; }
    .cute-body::-webkit-scrollbar-thumb { background: #e0e0e0; border-radius: 10px; }
    
    .close-x { cursor: pointer; color: #bbb; font-size: 16px; transition: 0.2s; }
    .close-x:hover { color: #d81b60; }
    
    /* ê°ì„± ë²„íŠ¼ & ì¸í’‹ */
    .btn-action { background: #fff; color: #666; border: 1px solid #ddd; border-radius: 20px; padding: 8px 18px; font-family: 'Galmuri9'; font-size: 12px; cursor: pointer; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.02);}
    .btn-action:hover { background: #fff0f5; color: #d81b60; border-color: #f8bbd0; transform: translateY(-1px);}
    .btn-action:active { transform: translateY(1px); box-shadow: none;}
    
    .cute-input { width: 100%; padding: 12px; margin-bottom: 15px; background: #fff; border: 1px solid #e5e5e5; border-radius: 10px; color: #555; font-family: 'Galmuri9'; box-sizing: border-box; outline: none; transition: 0.2s;}
    .cute-input:focus { border-color: #f8bbd0; box-shadow: 0 0 0 3px rgba(248, 187, 208, 0.2); }

    /* ê²Œì‹œíŒ ë¦¬ìŠ¤íŠ¸ ë””ìì¸ */
    .post-item { margin-bottom: 15px; background: #fff; border-radius: 12px; border: 1px solid #eee; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.02);}
    .post-header { padding: 15px 20px; font-weight: normal; color: #555; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s;}
    .post-header:hover { background: #fafafa; color: #d81b60; }
    .post-content-area { padding: 20px; display: none; background: #fff; font-size: 13px; line-height: 1.8; color: #666; border-top: 1px dashed #eee;}
    .post-date { font-size: 11px; color: #aaa; }

    /* ì˜ìƒ ì²¨ë¶€ ë°•ìŠ¤ */
    .upload-box { background: #fff; padding: 15px; border: 1px dashed #ccc; border-radius: 12px; margin-bottom: 15px; text-align: center; }
  </style>
</head>
<body id="main-body">

  <div id="left-taskbar">
      <div class="task-icon"><div>ğŸ </div>Room</div>
  </div>

  <div id="world-container">
      <div id="view-room" class="world-view active">
          <div id="room-darkness"></div> 
          <div id="light-beam"></div>

          <div id="scene-light" onclick="toggleLight()">ë”¸ê¹!</div>

          <div id="scene-pole"></div>
          <div id="scene-wire">
              <div class="crow" id="crow1" onclick="flyCrow(this)">ğŸ¦â€â¬›</div>
              <div class="crow" id="crow2" onclick="flyCrow(this)">ğŸ¦â€â¬›</div>
              <div class="crow" id="crow3" onclick="flyCrow(this)">ğŸ¦â€â¬›</div>
          </div>

          <div id="scene-window">
              <div id="window-pot">ğŸŒ¿</div>
              <span style="z-index: 25; text-align:center;">ì°½ë¬¸ ë°–<br>ë¹„ê°€ ë‚´ë¦°ë‹¤...</span>
              <div id="waterfall"></div>
              <div id="water-puddle"></div>
          </div>

          <div id="scene-character" onclick="alert('ëŒ€í™” ì‹œìŠ¤í…œ... ì•„ì§ ì ë“¤ì–´ìˆë‹¤...')">ë§ê±¸ê¸°</div>

          <div class="scene-pot" id="pot1" onclick="breakPot(this)">
              <div class="plant">ğŸŒ·</div><div class="base"></div>
          </div>
          <div class="scene-pot" id="pot2" onclick="breakPot(this)">
              <div class="plant">ğŸŒµ</div><div class="base"></div>
          </div>

          <div id="scene-bed" onclick="openBoard('diary')">
              <div id="scene-pillow"></div>
              <span style="transform: rotate(10deg); display:inline-block;">ë¹„ë°€ ì¼ê¸°ì¥</span>
          </div>

          <button class="btn-action" style="position:absolute; bottom:30px; right:30px; z-index: 100; box-shadow: 0 4px 10px rgba(0,0,0,0.1);" onclick="openPopup('profile-window')">âš™ï¸ ë°°ê²½ ì„¤ì •</button>
      </div>
  </div> 

  <div id="board-window" class="cute-popup" style="width: 550px; left: 150px; top: 100px;">
      <div class="cute-titlebar">
          <span id="board-title">DIARY & BOARD</span>
          <div style="display:flex; align-items:center; gap:15px;">
              <button class="btn-action" onclick="openWrite()">ê¸€ì“°ê¸°</button>
              <span class="close-x" onclick="closePopup('board-window')">âœ–</span>
          </div>
      </div>
      <div class="cute-body" id="page-content">
          <div style="text-align:center; padding: 40px; color:#bbb;">ìˆ˜íŒŒë² ì´ìŠ¤ ì—°ê²° ëŒ€ê¸°ì¤‘...</div>
      </div>
  </div>

  <div id="write-window" class="cute-popup" style="width: 550px; left: 200px; top: 80px;">
      <div class="cute-titlebar"><span>ìƒˆ ê¸€ ì‘ì„±</span><span class="close-x" onclick="closePopup('write-window')">âœ–</span></div>
      <div class="cute-body">
          <select id="post-category" class="cute-input" style="width: 150px;">
              <option value="diary">ë¹„ë°€ ì¼ê¸°</option>
              <option value="guestbook">ë°©ëª…ë¡</option>
          </select>
          <input type="text" id="post-title" class="cute-input" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”...">
          
          <div class="upload-box">
              <span style="color:#888; font-size:12px;">ğŸ¥ ì˜ìƒ ê°„í¸ ì²¨ë¶€ (Supabase Storage)</span><br>
              <div style="display:flex; gap:10px; justify-content:center; margin-top:10px; align-items:center;">
                  <input type="file" id="video-file" accept="video/*" style="font-size:11px; color:#666;">
                  <button class="btn-action" id="btn-vid-upload" onclick="uploadVideoToSupabase()">ë³¸ë¬¸ì— ì‚½ì…</button>
              </div>
          </div>

          <textarea id="post-content"></textarea>
          <div style="text-align:right; margin-top:20px;"><button class="btn-action" style="background:#fff0f5; color:#d81b60; border-color:#f8bbd0;" onclick="savePost()">ê¸°ë¡í•˜ê¸°</button></div>
      </div>
  </div>

  <div id="profile-window" class="cute-popup" style="width: 400px; right: 50px; top: 50px;">
      <div class="cute-titlebar"><span>SETTING</span><span class="close-x" onclick="closePopup('profile-window')">âœ–</span></div>
      <div class="cute-body">
          <p style="font-size:12px; color:#888; text-align:center; margin-bottom:20px;">ìì‹ ë§Œì˜ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ ë°©ì„ ê¾¸ë©°ë³´ì„¸ìš”.</p>
          <div style="margin-bottom:15px; font-size:12px; color:#555;">ğŸ–¼ï¸ ì „ì²´ ë°°ê²½ êµì²´ <input type="file" accept="image/*" class="cute-input" style="margin-top:5px; padding:8px;" onchange="handleImageUpload(event, 'bg')"></div>
          <div style="margin-bottom:15px; font-size:12px; color:#555;">ğŸ‘¤ ìºë¦­í„° êµì²´ <input type="file" accept="image/*" class="cute-input" style="margin-top:5px; padding:8px;" onchange="handleImageUpload(event, 'char')"></div>
          <div style="margin-bottom:15px; font-size:12px; color:#555;">ğŸ›ï¸ ì¹¨ëŒ€ ì»¤ë²„ êµì²´ <input type="file" accept="image/*" class="cute-input" style="margin-top:5px; padding:8px;" onchange="handleImageUpload(event, 'bed')"></div>
          <div style="text-align:center; margin-top:20px; border-top:1px dashed #eee; padding-top:20px;"><button class="btn-action" onclick="resetImages()">ê¸°ë³¸ ì´ë¯¸ì§€ë¡œ ì´ˆê¸°í™”</button></div>
      </div>
  </div>

  <script>
    let highestZ = 3000;
    
    // ìˆ˜íŒŒë² ì´ìŠ¤ ì†Œí™˜ì§„
    const SB_URL = "https://kzgbqpodvpuoqovfsyrm.supabase.co";
    const SB_KEY = "sb_publishable_pdqE1Sc-4PSv3LQM9IsBcA_xJWeZwW-";
    let sbClient = null; 
    if (window.supabase) sbClient = window.supabase.createClient(SB_URL, SB_KEY);
    
    CKEDITOR.replace('post-content', { height: 200, language: 'ko', removeButtons: 'About', versionCheck: false, toolbarCanCollapse: true });

    // ğŸªŸ ê¸°ë¯¹ ì œì–´
    function openPopup(id) { const el = document.getElementById(id); el.style.display = 'block'; el.style.zIndex = ++highestZ; }
    function closePopup(id) { document.getElementById(id).style.display = 'none'; }
    function toggleLight() { document.getElementById('view-room').classList.toggle('is-dark'); }
    function flyCrow(el) { el.classList.add('fly'); setTimeout(() => el.classList.remove('fly'), 5000); }
    function breakPot(el) { 
        if(!el.classList.contains('broken')) {
            el.classList.add('broken'); el.querySelector('.base').innerText = 'íŒ¡!';
            setTimeout(() => { el.classList.remove('broken'); el.querySelector('.base').innerText = '';}, 3000);
        }
    }

    // ë“œë˜ê·¸ (ë¶€ë“œëŸ¬ìš´ ì›€ì§ì„)
    function makeDraggable(winId) { 
        const win = document.getElementById(winId); const dragArea = win.querySelector('.cute-titlebar'); if(!dragArea) return;
        let p1=0, p2=0, p3=0, p4=0; win.onmousedown = () => win.style.zIndex = ++highestZ; 
        dragArea.onmousedown = (e) => { e.preventDefault(); p3=e.clientX; p4=e.clientY; document.onmouseup = () => { document.onmouseup=null; document.onmousemove=null; }; document.onmousemove = (e) => { e.preventDefault(); p1=p3-e.clientX; p2=p4-e.clientY; p3=e.clientX; p4=e.clientY; win.style.top=(win.offsetTop-p2)+"px"; win.style.left=(win.offsetLeft-p1)+"px"; }; }; 
    }
    ['profile-window', 'board-window', 'write-window'].forEach(makeDraggable);

    // === ğŸ–¼ï¸ ì»¤ìŠ¤í…€ ì´ë¯¸ì§€ ì €ì¥ ë§ˆìˆ  ===
    function handleImageUpload(event, targetElement) {
        const file = event.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const dataUrl = e.target.result;
            let savedImages = JSON.parse(localStorage.getItem('myRoomImages')) || {};
            if(targetElement === 'bg') { document.getElementById('view-room').style.backgroundImage = `url(${dataUrl})`; savedImages.bg = dataUrl; } 
            else if(targetElement === 'char') { const charEl = document.getElementById('scene-character'); charEl.style.backgroundImage = `url(${dataUrl})`; charEl.innerHTML = ''; charEl.style.backgroundColor = 'transparent'; charEl.style.border = 'none'; charEl.style.boxShadow = 'none'; savedImages.char = dataUrl; } 
            else if(targetElement === 'bed') { const bedEl = document.getElementById('scene-bed'); bedEl.style.backgroundImage = `url(${dataUrl})`; bedEl.style.backgroundColor = 'transparent'; bedEl.innerHTML = ''; bedEl.style.border = 'none'; savedImages.bed = dataUrl; }
            localStorage.setItem('myRoomImages', JSON.stringify(savedImages));
        };
        reader.readAsDataURL(file);
    }
    function loadSavedImages() {
        const savedImages = JSON.parse(localStorage.getItem('myRoomImages')) || {};
        if(savedImages.bg) document.getElementById('view-room').style.backgroundImage = `url(${savedImages.bg})`;
        if(savedImages.char) { const charEl = document.getElementById('scene-character'); charEl.style.backgroundImage = `url(${savedImages.char})`; charEl.innerHTML = ''; charEl.style.backgroundColor = 'transparent'; charEl.style.border = 'none'; charEl.style.boxShadow = 'none'; }
        if(savedImages.bed) { const bedEl = document.getElementById('scene-bed'); bedEl.style.backgroundImage = `url(${savedImages.bed})`; bedEl.style.backgroundColor = 'transparent'; bedEl.innerHTML = ''; bedEl.style.border = 'none'; }
    }
    function resetImages() { localStorage.removeItem('myRoomImages'); location.reload(); }

    // === ğŸ“ ê°ì„± ê²Œì‹œíŒ DB ì—°ë™ (ìˆ˜íŒŒë² ì´ìŠ¤) ===
    async function openBoard(type) { 
        document.getElementById('board-title').innerText = type==='diary' ? 'SECRET DIARY' : 'GUEST BOOK'; 
        document.getElementById('post-category').value = type; 
        document.getElementById('page-content').innerHTML = '<div style="text-align:center; padding: 40px; color:#bbb;">ê¸°ì–µì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>'; 
        openPopup('board-window'); 
        
        if (!sbClient) return document.getElementById('page-content').innerHTML = '<div style="text-align:center; padding: 40px; color:#bbb;">DB ì—ëŸ¬...</div>';
        const {data, error} = await sbClient.from('posts').select('*').eq('category', type).order('created_at',{ascending:false});
        if(error || !data || data.length === 0) return document.getElementById('page-content').innerHTML = '<div style="text-align:center; padding: 40px; color:#bbb;">ì•„ì§ ì‘ì„±ëœ ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
        
        let htmlStr = ''; 
        data.forEach(p => { 
            const dateStr = new Date(p.created_at).toLocaleDateString();
            htmlStr += `<div class="post-item"><div class="post-header" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='block'?'none':'block'"><span>ğŸ“ ${p.title}</span> <span class="post-date">${dateStr}</span></div><div class="post-content-area">${p.content}</div></div>`; 
        });
        document.getElementById('page-content').innerHTML = htmlStr;
    }
    
    function openWrite() { document.getElementById('post-title').value = ''; CKEDITOR.instances['post-content'].setData(''); openPopup('write-window'); }
    
    async function savePost() { 
        if(!sbClient) return;
        const category = document.getElementById('post-category').value; const title = document.getElementById('post-title').value; const content = CKEDITOR.instances['post-content'].getData();
        if(!title.trim()) return alert("ì œëª©ì„ ~ ì ì–´ë¼...");
        await sbClient.from('posts').insert([{title: title, content: content, category: category}]); 
        closePopup('write-window'); openBoard(category); 
    }

    // === ğŸ¥ ìˆ˜íŒŒë² ì´ìŠ¤ ìë™ ì˜ìƒ ì—…ë¡œë“œ ===
    async function uploadVideoToSupabase() {
        const fileInput = document.getElementById('video-file');
        const file = fileInput.files[0];
        if(!file) return alert("ì˜ìƒì„ ~ ê³¨ë¼ë¼...!");
        if(!sbClient) return alert("ìˆ˜íŒŒë² ì´ìŠ¤ ì—°ê²° ~ ëŠì–´ì¡Œë‹¤...!");

        const btn = document.getElementById('btn-vid-upload');
        btn.innerText = "ì—…ë¡œë“œ ì¤‘...";
        btn.disabled = true;

        const fileName = Date.now() + '_' + file.name;
        
        // ğŸš¨ ìˆ˜íŒŒë² ì´ìŠ¤ ìŠ¤í† ë¦¬ì§€ì— 'videos' ë²„í‚· í•„ìˆ˜
        const { data, error } = await sbClient.storage.from('videos').upload(fileName, file);
        
        if(error) {
            alert("ì—…ë¡œë“œ ì‹¤íŒ¨... ìˆ˜íŒŒë² ì´ìŠ¤ì— 'videos' ë²„í‚·ì„ ~ ë§Œë“¤ì–´ë¼...!");
            console.error(error);
            btn.innerText = "ë³¸ë¬¸ì— ì‚½ì…";
            btn.disabled = false;
            return;
        }

        const { data: publicUrlData } = sbClient.storage.from('videos').getPublicUrl(fileName);
        const videoUrl = publicUrlData.publicUrl;

        // ê¹”ë”í•œ ì˜ìƒ í”Œë ˆì´ì–´ ì‚½ì…
        const videoHtml = `<p style="text-align:center;"><video src="${videoUrl}" controls style="max-width:100%; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.05);"></video></p><p><br></p>`;
        CKEDITOR.instances['post-content'].insertHtml(videoHtml);
        
        btn.innerText = "ì‚½ì… ì™„ë£Œ!";
        setTimeout(() => { btn.innerText = "ë³¸ë¬¸ì— ì‚½ì…"; btn.disabled = false; fileInput.value = ''; }, 2000);
    }

    window.onload = loadSavedImages;
  </script>
</body>
</html>
